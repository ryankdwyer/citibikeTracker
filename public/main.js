'use strict';

var app = angular.module('citi', ['ui.router']);

app.controller('AuthController', function ($scope, AuthFactory, MapFactory) {
    var home = document.getElementById('pac-input-home');
    var homeBox = new google.maps.places.Autocomplete(home);
    var location;

    homeBox.addListener('place_changed', function () {
        location = parseLocation(homeBox.getPlace());
    });

    function parseLocation(placesObj) {
        return [{ lat: placesObj.geometry.location.G }, { lng: placesObj.geometry.location.K }];
    }

    $scope.signUp = function (credentials) {
        if (location) {
            credentials.home = location;
            AuthFactory.register(credentials).then(function () {
                $scope.closeModal();
            });
        } else {
            alert("Please enter a valid address");
        }
    };

    $scope.signInWithGoogle = function () {
        AuthFactory.signInWithGoogle().then(function (user) {
            $scope.closeModal();
            MapFactory.userHome = user.home;
            MapFactory.setCenter(MapFactory.userHome);
            alert('Welcome ' + user.name + '!');
        });
    };

    $scope.loginSubmit = function (credentials) {
        console.log($scope.loginForm);
        AuthFactory.login(credentials).then(function (user) {
            $scope.closeModal();
            MapFactory.userHome = user.home;
            console.log('user home', MapFactory.userHome);
            MapFactory.setCenter(MapFactory.userHome);
            alert('Welcome ' + user.name + '!');
        });
    };

    $scope.logOut = function () {
        AuthFactory.logOut();
    };

    $scope.showLogin = function () {
        var modal = angular.element('#loginModal');
        modal.removeClass('hide');
        modal.addClass('show');
    };

    $scope.showSignup = function () {
        var modal = angular.element('#signupModal');
        modal.removeClass('hide');
        modal.addClass('show');
    };

    $scope.closeModal = function () {
        angular.element('#loginModal').addClass('hide');
        angular.element('#loginModal').removeClass('show');
        angular.element('#signupModal').addClass('hide');
        angular.element('#signupModal').removeClass('show');
    };
});

app.factory('AuthFactory', function ($http, $state) {
    function toData(response) {
        return response.data;
    }
    return {
        login: function login(credentials) {
            return $http.post('/api/login', credentials).then(toData);
        },
        register: function register(credentials) {
            return $http.post('api/register', credentials).then(toData);
        },
        logout: function logout() {
            return $http.post('api/logout').then(toData);
        },
        signInWithGoogle: function signInWithGoogle() {
            return $http.get('api/auth/google').then(function (response) {
                return response.data;
            });
        }
    };
});

app.directive('login', function () {
    return {
        restrict: 'E',
        templateUrl: '/app/auth/auth.html',
        controller: 'AuthController'
    };
});

app.controller('MapController', function ($scope, MapFactory, stations, updates) {
    var map;
    $scope.initMap = function () {
        var home = {
            lat: 40.729546,
            lng: -73.98569
        };

        map = new google.maps.Map(angular.element('#map-canvas')[0], {
            center: home,
            zoom: 13
        });
        MapFactory.map = map;

        var bikeLayer = new google.maps.BicyclingLayer();
        bikeLayer.setMap(map);

        var bounds = new google.maps.LatLngBounds();

        var infowindow = new google.maps.InfoWindow();
        map.addListener('click', function () {
            infowindow.close();
        });

        stations.data.forEach(function (el) {
            var marker = $scope.drawLocation([el.latitude, el.longitude], {});
            MapFactory.markers.push(marker);
            marker.addListener('click', function () {
                infowindow.close();
                contentString = "<p>Station: " + el.label + "</p>" + "<p>Bikes: " + updates.data[el.stationId][0] + '</p>' + "<p>Docks: " + updates.data[el.stationId][1] + '</p>' + "<p>Active: " + el.status + '</p>' + "<p>Last Update: " + $scope.setDate(updates.data[el.stationId][2]) + '</p>';
                infowindow.setContent(contentString);
                infowindow.open(map, marker);
            });
        });
    };

    $scope.updater = function () {
        MapFactory.getUpdates().then(function (response) {
            updates = response;
            $scope.initMap();
        });
    };

    $scope.removeMarkers = function () {
        MapFactory.markers.forEach(function (el) {
            el.setMap(null);
        });
    };

    $scope.showMarkers = function () {
        MapFactory.markers.forEach(function (el) {
            el.setMap(MapFactory.map);
        });
    };

    $scope.setDate = function (unix) {
        var date = new Date(unix * 1000);
        var hours = date.getHours();
        var ampm = date.getHours() > 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        var minutes = date.getMinutes();
        minutes = minutes < 10 ? '0' + minutes : minutes;
        return 'Today @ ' + hours + ':' + minutes + ' ' + ampm;
    };

    $scope.drawLocation = function (location, opts) {
        if (typeof opts !== 'object') {
            opts = {};
        }
        opts.icon = '/images/bike.png';
        opts.position = new google.maps.LatLng(location[0], location[1]);
        opts.map = map;
        return new google.maps.Marker(opts);
    };

    $scope.setMapCenter = function (locationObj) {
        var center = new google.maps.LatLng(locationObj[0].lat, locationObj[1].lng);
        MapFactory.map.setCenter(center);
    };

    $scope.initMap();
});

app.factory('MapFactory', function ($http) {
    return {
        stations: [],
        updates: {},
        origin: null,
        destination: null,
        map: null,
        userHome: null,
        markers: [],
        getStations: function getStations() {
            return $http.get('/api/stations').then(function (response) {
                return response;
            });
        },
        getUpdates: function getUpdates() {
            return $http.get('/api/update').then(function (response) {
                return response;
            });
        },
        setCenter: function setCenter(locationObj) {
            var center = new google.maps.LatLng(locationObj[0].lat, locationObj[1].lng);
            this.map.setCenter(center);
        }
    };
});
app.config(function ($stateProvider, $urlRouterProvider) {
    $stateProvider.state('map', {
        url: '',
        templateUrl: "/app/map/map.html",
        controller: 'MapController',
        resolve: {
            stations: function stations(MapFactory) {
                return MapFactory.getStations();
            },
            updates: function updates(MapFactory) {
                return MapFactory.getUpdates();
            }
        }
    });
    $stateProvider.state('map.panel', {
        url: '/panel',
        templateUrl: '/app/panel/panel.html',
        controller: 'PanelController'
    });
    $urlRouterProvider.when('/api/auth/google', '/');
});

app.controller('PanelController', function ($scope, MapFactory) {
    var origin = document.getElementById('pac-input-origin');
    var originBox = new google.maps.places.Autocomplete(origin);
    var destination = document.getElementById('pac-input-destination');
    var destinationBox = new google.maps.places.Autocomplete(destination);

    originBox.addListener('place_changed', function () {
        MapFactory.origin = originBox.getPlace();
    });

    destinationBox.addListener('place_changed', function () {
        MapFactory.destination = destinationBox.getPlace();
    });

    function newLatLngObj(locationObj) {
        return new google.maps.LatLng(locationObj.geometry.location.G, locationObj.geometry.location.K);
    }

    $scope.setBounds = function () {
        var bounds = new google.maps.LatLngBounds();
        origin = newLatLngObj(MapFactory.origin);
        destination = newLatLngObj(MapFactory.destination);
        bounds.extend(origin);
        bounds.extend(destination);
        MapFactory.map.fitBounds(bounds);
    };

    $scope.getTravelTime = function () {
        var service = new google.maps.DistanceMatrixService();
        var infowindow = new google.maps.InfoWindow();

        service.getDistanceMatrix({
            origins: [newLatLngObj(MapFactory.origin)],
            destinations: [newLatLngObj(MapFactory.destination)],
            travelMode: google.maps.TravelMode.BICYCLING
        }, function (response, status) {
            if (status === google.maps.DistanceMatrixStatus.OK) {
                console.log(response);
                console.log(response.rows[0].elements[0].duration.text);
                infowindow.setContent(response.rows[0].elements[0].duration.text);
            }
        });
    };

    $scope.calcAndDisplayRoute = function () {
        var directionsService = new google.maps.DirectionsService();
        $scope.getTravelTime();
        directionsService.route({
            origin: newLatLngObj(MapFactory.origin),
            destination: newLatLngObj(MapFactory.destination),
            travelMode: google.maps.TravelMode.BICYCLING,
            provideRouteAlternatives: true
        }, function (response, status) {
            if (status === google.maps.DirectionsStatus.OK) {
                for (var i = 0; i < response.routes.length; i++) {
                    var color = i === 0 ? 'DodgerBlue' : 'DarkGray';
                    var zIndex = i === 0 ? 1000 : null;
                    var directions = new google.maps.DirectionsRenderer({
                        map: MapFactory.map,
                        directions: response,
                        routeIndex: i,
                        polylineOptions: {
                            strokeColor: color,
                            zIndex: zIndex,
                            strokeWeight: 5
                        }
                    });
                    if (i === 0) directions.setPanel(document.getElementById('directionsPanel'));
                }
            } else {
                window.alert('Directions request failed due to: ', status);
            }
        });
    };
});

app.directive('footer', function () {
    return {
        restrict: "E",
        templateUrl: "/footer.html"
    };
});
app.directive('modal', function () {
    return {
        restrict: 'E',
        templateUrl: '/modal.html'
    };
});
app.controller('NavbarController', function ($scope, $http, AuthFactory) {
    $scope.showLogin = function () {
        var modal = angular.element('#loginModal');
        if (modal.hasClass('show')) {
            modal.removeClass('show');
            modal.addClass('hide');
        } else {
            modal.removeClass('hide');
            modal.addClass('show');
        }
    };

    $scope.logout = function () {
        AuthFactory.logout();
    };

    $scope.closeModal = function () {
        angular.element('#loginModal').addClass('hide');
        angular.element('#loginModal').removeClass('show');
    };
});
app.directive('navbar', function () {
    return {
        restrict: 'E',
        templateUrl: "/navbar.html",
        controller: 'NavbarController'
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC9hdXRoL2F1dGguY29udHJvbGxlci5qcyIsImFwcC9hdXRoL2F1dGguZmFjdG9yeS5qcyIsImFwcC9hdXRoL2F1dGguanMiLCJhcHAvbWFwL21hcC5jb250cm9sbGVyLmpzIiwiYXBwL21hcC9tYXAuZmFjdG9yeS5qcyIsImFwcC9tYXAvbWFwLnN0YXRlLmpzIiwiYXBwL3BhbmVsL3BhbmVsLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL2Zvb3Rlci9mb290ZXIuanMiLCJjb21wb25lbnRzL21vZGFsL21vZGFsLmpzIiwiY29tcG9uZW50cy9uYXZiYXIvbmF2YmFyLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL25hdmJhci9uYXZiYXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBLEdBQUEsR0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUE7O0FDQUEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxnQkFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFdBQUEsRUFBQSxVQUFBLEVBQUE7QUFDQSxRQUFBLElBQUEsR0FBQSxRQUFBLENBQUEsY0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQTtBQUNBLFFBQUEsT0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsWUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsUUFBQSxRQUFBLENBQUE7O0FBRUEsV0FBQSxDQUFBLFdBQUEsQ0FBQSxlQUFBLEVBQUEsWUFBQTtBQUNBLGdCQUFBLEdBQUEsYUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLEVBQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQSxDQUFBOztBQUVBLGFBQUEsYUFBQSxDQUFBLFNBQUEsRUFBQTtBQUNBLGVBQUEsQ0FDQSxFQUFBLEdBQUEsRUFBQSxTQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEVBQUEsRUFDQSxFQUFBLEdBQUEsRUFBQSxTQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FDQSxDQUFBO0tBQ0E7O0FBRUEsVUFBQSxDQUFBLE1BQUEsR0FBQSxVQUFBLFdBQUEsRUFBQTtBQUNBLFlBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsQ0FBQSxJQUFBLEdBQUEsUUFBQSxDQUFBO0FBQ0EsdUJBQUEsQ0FBQSxRQUFBLENBQUEsV0FBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFlBQUE7QUFDQSxzQkFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO2FBQ0EsQ0FBQSxDQUFBO1NBQ0EsTUFBQTtBQUNBLGlCQUFBLENBQUEsOEJBQUEsQ0FBQSxDQUFBO1NBQ0E7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxnQkFBQSxHQUFBLFlBQUE7QUFDQSxtQkFBQSxDQUFBLGdCQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxrQkFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxRQUFBLEdBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLHNCQUFBLENBQUEsU0FBQSxDQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsVUFBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxXQUFBLEdBQUEsVUFBQSxXQUFBLEVBQUE7QUFDQSxlQUFBLENBQUEsR0FBQSxDQUFBLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQTtBQUNBLG1CQUFBLENBQUEsS0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLElBQUEsRUFBQTtBQUNBLGtCQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxzQkFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLENBQUEsSUFBQSxDQUFBO0FBQ0EsbUJBQUEsQ0FBQSxHQUFBLENBQUEsV0FBQSxFQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLHNCQUFBLENBQUEsU0FBQSxDQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsVUFBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxNQUFBLEdBQUEsWUFBQTtBQUNBLG1CQUFBLENBQUEsTUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxTQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsS0FBQSxHQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7QUFDQSxhQUFBLENBQUEsV0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsYUFBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLFVBQUEsR0FBQSxZQUFBO0FBQ0EsWUFBQSxLQUFBLEdBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQTtBQUNBLGFBQUEsQ0FBQSxXQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxhQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsVUFBQSxHQUFBLFlBQUE7QUFDQSxlQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLGVBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUEsV0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsZUFBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxlQUFBLENBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBLFdBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDeEVBLEdBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxFQUFBLFVBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQTtBQUNBLGFBQUEsTUFBQSxDQUFBLFFBQUEsRUFBQTtBQUNBLGVBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQTtLQUNBO0FBQ0EsV0FBQTtBQUNBLGFBQUEsRUFBQSxlQUFBLFdBQUEsRUFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsWUFBQSxFQUFBLFdBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtTQUNBO0FBQ0EsZ0JBQUEsRUFBQSxrQkFBQSxXQUFBLEVBQUE7QUFDQSxtQkFBQSxLQUFBLENBQUEsSUFBQSxDQUFBLGNBQUEsRUFBQSxXQUFBLENBQUEsQ0FDQSxJQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7U0FDQTtBQUNBLGNBQUEsRUFBQSxrQkFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsWUFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1NBQ0E7QUFDQSx3QkFBQSxFQUFBLDRCQUFBO0FBQ0EsbUJBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxpQkFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBO0tBQ0EsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUN4QkEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxPQUFBLEVBQUEsWUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEdBQUE7QUFDQSxtQkFBQSxFQUFBLHFCQUFBO0FBQ0Esa0JBQUEsRUFBQSxnQkFBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDTkEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxlQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsVUFBQSxFQUFBLFFBQUEsRUFBQSxPQUFBLEVBQUE7QUFDQSxRQUFBLEdBQUEsQ0FBQTtBQUNBLFVBQUEsQ0FBQSxPQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsSUFBQSxHQUFBO0FBQ0EsZUFBQSxFQUFBLFNBQUE7QUFDQSxlQUFBLEVBQUEsQ0FBQSxRQUFBO1NBQ0EsQ0FBQTs7QUFFQSxXQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxFQUFBO0FBQ0Esa0JBQUEsRUFBQSxJQUFBO0FBQ0EsZ0JBQUEsRUFBQSxFQUFBO1NBQ0EsQ0FBQSxDQUFBO0FBQ0Esa0JBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBOztBQUVBLFlBQUEsU0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxjQUFBLEVBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsTUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBOztBQUVBLFlBQUEsTUFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQTs7QUFFQSxZQUFBLFVBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxXQUFBLENBQUEsV0FBQSxDQUFBLE9BQUEsRUFBQSxZQUFBO0FBQ0Esc0JBQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQTtTQUNBLENBQUEsQ0FBQTs7QUFFQSxnQkFBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxFQUFBLEVBQUE7QUFDQSxnQkFBQSxNQUFBLEdBQUEsTUFBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxRQUFBLEVBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0Esa0JBQUEsQ0FBQSxXQUFBLENBQUEsT0FBQSxFQUFBLFlBQUE7QUFDQSwwQkFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO0FBQ0EsNkJBQUEsR0FBQSxjQUFBLEdBQUEsRUFBQSxDQUFBLEtBQUEsR0FBQSxNQUFBLEdBQ0EsWUFBQSxHQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLE1BQUEsR0FDQSxZQUFBLEdBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsTUFBQSxHQUNBLGFBQUEsR0FBQSxFQUFBLENBQUEsTUFBQSxHQUFBLE1BQUEsR0FDQSxrQkFBQSxHQUFBLE1BQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQSxNQUFBLENBQUE7QUFDQSwwQkFBQSxDQUFBLFVBQUEsQ0FBQSxhQUFBLENBQUEsQ0FBQTtBQUNBLDBCQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLE9BQUEsR0FBQSxZQUFBO0FBQ0Esa0JBQUEsQ0FBQSxVQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxtQkFBQSxHQUFBLFFBQUEsQ0FBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxFQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxhQUFBLEdBQUEsWUFBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxXQUFBLEdBQUEsWUFBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsVUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO1NBQ0EsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsT0FBQSxHQUFBLFVBQUEsSUFBQSxFQUFBO0FBQ0EsWUFBQSxJQUFBLEdBQUEsSUFBQSxJQUFBLENBQUEsSUFBQSxHQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsWUFBQSxLQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxDQUFBO0FBQ0EsWUFBQSxJQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxJQUFBLEdBQUEsSUFBQSxDQUFBO0FBQ0EsYUFBQSxHQUFBLEtBQUEsR0FBQSxFQUFBLENBQUE7QUFDQSxhQUFBLEdBQUEsS0FBQSxHQUFBLEtBQUEsR0FBQSxFQUFBLENBQUE7QUFDQSxZQUFBLE9BQUEsR0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxlQUFBLEdBQUEsT0FBQSxHQUFBLEVBQUEsR0FBQSxHQUFBLEdBQUEsT0FBQSxHQUFBLE9BQUEsQ0FBQTtBQUNBLGVBQUEsVUFBQSxHQUFBLEtBQUEsR0FBQSxHQUFBLEdBQUEsT0FBQSxHQUFBLEdBQUEsR0FBQSxJQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxZQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUEsSUFBQSxFQUFBO0FBQ0EsWUFBQSxPQUFBLElBQUEsS0FBQSxRQUFBLEVBQUE7QUFDQSxnQkFBQSxHQUFBLEVBQUEsQ0FBQTtTQUNBO0FBQ0EsWUFBQSxDQUFBLElBQUEsR0FBQSxrQkFBQSxDQUFBO0FBQ0EsWUFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQTtBQUNBLFlBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBO0FBQ0EsZUFBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsWUFBQSxHQUFBLFVBQUEsV0FBQSxFQUFBO0FBQ0EsWUFBQSxNQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQSxFQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtBQUNBLGtCQUFBLENBQUEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLE9BQUEsRUFBQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQ3ZGQSxHQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsRUFBQSxVQUFBLEtBQUEsRUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEVBQUE7QUFDQSxlQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsRUFBQSxJQUFBO0FBQ0EsbUJBQUEsRUFBQSxJQUFBO0FBQ0EsV0FBQSxFQUFBLElBQUE7QUFDQSxnQkFBQSxFQUFBLElBQUE7QUFDQSxlQUFBLEVBQUEsRUFBQTtBQUNBLG1CQUFBLEVBQUEsdUJBQUE7QUFDQSxtQkFBQSxLQUFBLENBQUEsR0FBQSxDQUFBLGVBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLHVCQUFBLFFBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBO0FBQ0Esa0JBQUEsRUFBQSxzQkFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsYUFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsUUFBQSxDQUFBO2FBQ0EsQ0FBQSxDQUFBO1NBQ0E7QUFDQSxpQkFBQSxFQUFBLG1CQUFBLFdBQUEsRUFBQTtBQUNBLGdCQUFBLE1BQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLEVBQUEsV0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO0FBQ0EsZ0JBQUEsQ0FBQSxHQUFBLENBQUEsU0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1NBQ0E7S0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBO0FDMUJBLEdBQUEsQ0FBQSxNQUFBLENBQUEsVUFBQSxjQUFBLEVBQUEsa0JBQUEsRUFBQTtBQUNBLGtCQUFBLENBQ0EsS0FBQSxDQUFBLEtBQUEsRUFBQTtBQUNBLFdBQUEsRUFBQSxFQUFBO0FBQ0EsbUJBQUEsRUFBQSxtQkFBQTtBQUNBLGtCQUFBLEVBQUEsZUFBQTtBQUNBLGVBQUEsRUFBQTtBQUNBLG9CQUFBLEVBQUEsa0JBQUEsVUFBQSxFQUFBO0FBQ0EsdUJBQUEsVUFBQSxDQUFBLFdBQUEsRUFBQSxDQUFBO2FBQ0E7QUFDQSxtQkFBQSxFQUFBLGlCQUFBLFVBQUEsRUFBQTtBQUNBLHVCQUFBLFVBQUEsQ0FBQSxVQUFBLEVBQUEsQ0FBQTthQUNBO1NBQ0E7S0FDQSxDQUFBLENBQUE7QUFDQSxrQkFBQSxDQUNBLEtBQUEsQ0FBQSxXQUFBLEVBQUE7QUFDQSxXQUFBLEVBQUEsUUFBQTtBQUNBLG1CQUFBLEVBQUEsdUJBQUE7QUFDQSxrQkFBQSxFQUFBLGlCQUFBO0tBQ0EsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxJQUFBLENBQUEsa0JBQUEsRUFBQSxHQUFBLENBQUEsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUN0QkEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxpQkFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFVBQUEsRUFBQTtBQUNBLFFBQUEsTUFBQSxHQUFBLFFBQUEsQ0FBQSxjQUFBLENBQUEsa0JBQUEsQ0FBQSxDQUFBO0FBQ0EsUUFBQSxTQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxZQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxRQUFBLFdBQUEsR0FBQSxRQUFBLENBQUEsY0FBQSxDQUFBLHVCQUFBLENBQUEsQ0FBQTtBQUNBLFFBQUEsY0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsWUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUVBLGFBQUEsQ0FBQSxXQUFBLENBQUEsZUFBQSxFQUFBLFlBQUE7QUFDQSxrQkFBQSxDQUFBLE1BQUEsR0FBQSxTQUFBLENBQUEsUUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBLENBQUE7O0FBRUEsa0JBQUEsQ0FBQSxXQUFBLENBQUEsZUFBQSxFQUFBLFlBQUE7QUFDQSxrQkFBQSxDQUFBLFdBQUEsR0FBQSxjQUFBLENBQUEsUUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBLENBQUE7O0FBRUEsYUFBQSxZQUFBLENBQUEsV0FBQSxFQUFBO0FBQ0EsZUFBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUNBLFdBQUEsQ0FBQSxRQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsRUFDQSxXQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLENBQ0EsQ0FBQTtLQUNBOztBQUVBLFVBQUEsQ0FBQSxTQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsTUFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQTtBQUNBLGNBQUEsR0FBQSxZQUFBLENBQUEsVUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsbUJBQUEsR0FBQSxZQUFBLENBQUEsVUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBO0FBQ0EsY0FBQSxDQUFBLE1BQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsV0FBQSxDQUFBLENBQUE7QUFDQSxrQkFBQSxDQUFBLEdBQUEsQ0FBQSxTQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxhQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsT0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxxQkFBQSxFQUFBLENBQUE7QUFDQSxZQUFBLFVBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7O0FBRUEsZUFBQSxDQUFBLGlCQUFBLENBQUE7QUFDQSxtQkFBQSxFQUFBLENBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLHdCQUFBLEVBQUEsQ0FBQSxZQUFBLENBQUEsVUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsRUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsQ0FBQSxTQUFBO1NBQ0EsRUFBQSxVQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUE7QUFDQSxnQkFBQSxNQUFBLEtBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxvQkFBQSxDQUFBLEVBQUEsRUFBQTtBQUNBLHVCQUFBLENBQUEsR0FBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBO0FBQ0EsdUJBQUEsQ0FBQSxHQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsMEJBQUEsQ0FBQSxVQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO2FBQ0E7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxtQkFBQSxHQUFBLFlBQUE7QUFDQSxZQUFBLGlCQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLGlCQUFBLEVBQUEsQ0FBQTtBQUNBLGNBQUEsQ0FBQSxhQUFBLEVBQUEsQ0FBQTtBQUNBLHlCQUFBLENBQUEsS0FBQSxDQUFBO0FBQ0Esa0JBQUEsRUFBQSxZQUFBLENBQUEsVUFBQSxDQUFBLE1BQUEsQ0FBQTtBQUNBLHVCQUFBLEVBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxXQUFBLENBQUE7QUFDQSxzQkFBQSxFQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsVUFBQSxDQUFBLFNBQUE7QUFDQSxvQ0FBQSxFQUFBLElBQUE7U0FDQSxFQUFBLFVBQUEsUUFBQSxFQUFBLE1BQUEsRUFBQTtBQUNBLGdCQUFBLE1BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLGdCQUFBLENBQUEsRUFBQSxFQUFBO0FBQ0EscUJBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLEVBQUEsRUFBQTtBQUNBLHdCQUFBLEtBQUEsR0FBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLFlBQUEsR0FBQSxVQUFBLENBQUE7QUFDQSx3QkFBQSxNQUFBLEdBQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxJQUFBLEdBQUEsSUFBQSxDQUFBO0FBQ0Esd0JBQUEsVUFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxrQkFBQSxDQUFBO0FBQ0EsMkJBQUEsRUFBQSxVQUFBLENBQUEsR0FBQTtBQUNBLGtDQUFBLEVBQUEsUUFBQTtBQUNBLGtDQUFBLEVBQUEsQ0FBQTtBQUNBLHVDQUFBLEVBQUE7QUFDQSx1Q0FBQSxFQUFBLEtBQUE7QUFDQSxrQ0FBQSxFQUFBLE1BQUE7QUFDQSx3Q0FBQSxFQUFBLENBQUE7eUJBQ0E7cUJBQ0EsQ0FBQSxDQUFBO0FBQ0Esd0JBQUEsQ0FBQSxLQUFBLENBQUEsRUFBQSxVQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxjQUFBLENBQUEsaUJBQUEsQ0FBQSxDQUFBLENBQUE7aUJBQ0E7YUFDQSxNQUFBO0FBQ0Esc0JBQUEsQ0FBQSxLQUFBLENBQUEsb0NBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQTthQUNBO1NBQ0EsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUM3RUEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxRQUFBLEVBQUEsWUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEdBQUE7QUFDQSxtQkFBQSxFQUFBLGNBQUE7S0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBO0FDTEEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxPQUFBLEVBQUEsWUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEdBQUE7QUFDQSxtQkFBQSxFQUFBLGFBQUE7S0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBO0FDTEEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxrQkFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUE7QUFDQSxVQUFBLENBQUEsU0FBQSxHQUFBLFlBQUE7QUFDQSxZQUFBLEtBQUEsR0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBO0FBQ0EsWUFBQSxLQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxFQUFBO0FBQ0EsaUJBQUEsQ0FBQSxXQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxpQkFBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtTQUNBLE1BQUE7QUFDQSxpQkFBQSxDQUFBLFdBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1NBQ0E7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxNQUFBLEdBQUEsWUFBQTtBQUNBLG1CQUFBLENBQUEsTUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxVQUFBLEdBQUEsWUFBQTtBQUNBLGVBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsZUFBQSxDQUFBLE9BQUEsQ0FBQSxhQUFBLENBQUEsQ0FBQSxXQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7S0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBO0FDcEJBLEdBQUEsQ0FBQSxTQUFBLENBQUEsUUFBQSxFQUFBLFlBQUE7QUFDQSxXQUFBO0FBQ0EsZ0JBQUEsRUFBQSxHQUFBO0FBQ0EsbUJBQUEsRUFBQSxjQUFBO0FBQ0Esa0JBQUEsRUFBQSxrQkFBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUEiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2l0aScsIFsndWkucm91dGVyJ10pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ0F1dGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgQXV0aEZhY3RvcnksIE1hcEZhY3RvcnkpIHtcbiAgICB2YXIgaG9tZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWMtaW5wdXQtaG9tZScpO1xuICAgIHZhciBob21lQm94ID0gbmV3IGdvb2dsZS5tYXBzLnBsYWNlcy5BdXRvY29tcGxldGUoaG9tZSk7XG4gICAgdmFyIGxvY2F0aW9uO1xuXG4gICAgaG9tZUJveC5hZGRMaXN0ZW5lcigncGxhY2VfY2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9jYXRpb24gPSBwYXJzZUxvY2F0aW9uKGhvbWVCb3guZ2V0UGxhY2UoKSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwYXJzZUxvY2F0aW9uKHBsYWNlc09iaikge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAge2xhdDogcGxhY2VzT2JqLmdlb21ldHJ5LmxvY2F0aW9uLkd9LFxuICAgICAgICAgICAge2xuZzogcGxhY2VzT2JqLmdlb21ldHJ5LmxvY2F0aW9uLkt9XG4gICAgICAgICAgICBdO1xuICAgIH1cblxuICAgICRzY29wZS5zaWduVXAgPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKGxvY2F0aW9uKSB7XG4gICAgICAgICAgICBjcmVkZW50aWFscy5ob21lID0gbG9jYXRpb247XG4gICAgICAgICAgICBBdXRoRmFjdG9yeS5yZWdpc3RlcihjcmVkZW50aWFscylcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWxlcnQoXCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBhZGRyZXNzXCIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5zaWduSW5XaXRoR29vZ2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBBdXRoRmFjdG9yeS5zaWduSW5XaXRoR29vZ2xlKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcil7XG4gICAgICAgICAgICAkc2NvcGUuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgTWFwRmFjdG9yeS51c2VySG9tZSA9IHVzZXIuaG9tZTtcbiAgICAgICAgICAgIE1hcEZhY3Rvcnkuc2V0Q2VudGVyKE1hcEZhY3RvcnkudXNlckhvbWUpO1xuICAgICAgICAgICAgYWxlcnQoJ1dlbGNvbWUgJyArIHVzZXIubmFtZSArICchJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUubG9naW5TdWJtaXQgPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmxvZ2luRm9ybSk7XG4gICAgICAgIEF1dGhGYWN0b3J5LmxvZ2luKGNyZWRlbnRpYWxzKVxuICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKXtcbiAgICAgICAgICAgICRzY29wZS5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICBNYXBGYWN0b3J5LnVzZXJIb21lID0gdXNlci5ob21lO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXIgaG9tZScsIE1hcEZhY3RvcnkudXNlckhvbWUpO1xuICAgICAgICAgICAgTWFwRmFjdG9yeS5zZXRDZW50ZXIoTWFwRmFjdG9yeS51c2VySG9tZSk7XG4gICAgICAgICAgICBhbGVydCgnV2VsY29tZSAnICsgdXNlci5uYW1lICsgJyEnKTtcbiAgICAgICAgfSk7IFxuICAgIH07XG5cbiAgICAkc2NvcGUubG9nT3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBBdXRoRmFjdG9yeS5sb2dPdXQoKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNob3dMb2dpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1vZGFsID0gYW5ndWxhci5lbGVtZW50KCcjbG9naW5Nb2RhbCcpO1xuICAgICAgICBtb2RhbC5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICBtb2RhbC5hZGRDbGFzcygnc2hvdycpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2hvd1NpZ251cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1vZGFsID0gYW5ndWxhci5lbGVtZW50KCcjc2lnbnVwTW9kYWwnKTtcbiAgICAgICAgbW9kYWwucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgbW9kYWwuYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI2xvZ2luTW9kYWwnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNsb2dpbk1vZGFsJykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjc2lnbnVwTW9kYWwnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNzaWdudXBNb2RhbCcpLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgfTtcbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ0F1dGhGYWN0b3J5JywgZnVuY3Rpb24gKCRodHRwLCAkc3RhdGUpIHtcbiAgICBmdW5jdGlvbiB0b0RhdGEocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGxvZ2luOiBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2xvZ2luJywgY3JlZGVudGlhbHMpXG4gICAgICAgICAgICAgICAgLnRoZW4odG9EYXRhKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVnaXN0ZXI6IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJ2FwaS9yZWdpc3RlcicsIGNyZWRlbnRpYWxzKVxuICAgICAgICAgICAgICAgIC50aGVuKHRvRGF0YSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvZ291dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJ2FwaS9sb2dvdXQnKVxuICAgICAgICAgICAgICAgIC50aGVuKHRvRGF0YSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNpZ25JbldpdGhHb29nbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJ2FwaS9hdXRoL2dvb2dsZScpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn0pO1xuIiwiYXBwLmRpcmVjdGl2ZSgnbG9naW4nLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6ICcvYXBwL2F1dGgvYXV0aC5odG1sJyxcblx0XHRjb250cm9sbGVyOiAnQXV0aENvbnRyb2xsZXInXG5cdH07XG59KTsiLCJhcHAuY29udHJvbGxlcignTWFwQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsIE1hcEZhY3RvcnksIHN0YXRpb25zLCB1cGRhdGVzKSB7XG4gICAgdmFyIG1hcDtcbiAgICAkc2NvcGUuaW5pdE1hcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhvbWUgPSB7XG4gICAgICAgICAgICBsYXQ6IDQwLjcyOTU0NixcbiAgICAgICAgICAgIGxuZzogLTczLjk4NTY5XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGFuZ3VsYXIuZWxlbWVudCgnI21hcC1jYW52YXMnKVswXSwge1xuICAgICAgICAgICAgY2VudGVyOiBob21lLFxuICAgICAgICAgICAgem9vbTogMTNcbiAgICAgICAgfSk7XG4gICAgICAgIE1hcEZhY3RvcnkubWFwID0gbWFwO1xuXG4gICAgICAgIHZhciBiaWtlTGF5ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuQmljeWNsaW5nTGF5ZXIoKTtcbiAgICAgICAgYmlrZUxheWVyLnNldE1hcChtYXApO1xuXG4gICAgICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XG4gICAgICAgIFxuICAgICAgICB2YXIgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG4gICAgICAgIG1hcC5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbmZvd2luZG93LmNsb3NlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgc3RhdGlvbnMuZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgdmFyIG1hcmtlciA9ICRzY29wZS5kcmF3TG9jYXRpb24oW2VsLmxhdGl0dWRlLCBlbC5sb25naXR1ZGVdLCB7fSk7XG4gICAgICAgICAgICBNYXBGYWN0b3J5Lm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICAgICAgICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgY29udGVudFN0cmluZyA9IFwiPHA+U3RhdGlvbjogXCIgKyBlbC5sYWJlbCArIFwiPC9wPlwiICtcbiAgICAgICAgICAgICAgICAgICAgXCI8cD5CaWtlczogXCIgKyB1cGRhdGVzLmRhdGFbZWwuc3RhdGlvbklkXVswXSArICc8L3A+JyArXG4gICAgICAgICAgICAgICAgICAgIFwiPHA+RG9ja3M6IFwiICsgdXBkYXRlcy5kYXRhW2VsLnN0YXRpb25JZF1bMV0gKyAnPC9wPicgK1xuICAgICAgICAgICAgICAgICAgICBcIjxwPkFjdGl2ZTogXCIgKyBlbC5zdGF0dXMgKyAnPC9wPicgK1xuICAgICAgICAgICAgICAgICAgICBcIjxwPkxhc3QgVXBkYXRlOiBcIiArICRzY29wZS5zZXREYXRlKHVwZGF0ZXMuZGF0YVtlbC5zdGF0aW9uSWRdWzJdKSArICc8L3A+JztcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93LnNldENvbnRlbnQoY29udGVudFN0cmluZyk7XG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnVwZGF0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIE1hcEZhY3RvcnkuZ2V0VXBkYXRlcygpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVzID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXRNYXAoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUucmVtb3ZlTWFya2VycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTWFwRmFjdG9yeS5tYXJrZXJzLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICBlbC5zZXRNYXAobnVsbCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2hvd01hcmtlcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIE1hcEZhY3RvcnkubWFya2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgZWwuc2V0TWFwKE1hcEZhY3RvcnkubWFwKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zZXREYXRlID0gZnVuY3Rpb24gKHVuaXgpIHtcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh1bml4ICogMTAwMCk7XG4gICAgICAgIHZhciBob3VycyA9IGRhdGUuZ2V0SG91cnMoKTtcbiAgICAgICAgdmFyIGFtcG0gPSAoZGF0ZS5nZXRIb3VycygpID4gMTIpID8gJ1BNJyA6ICdBTSc7XG4gICAgICAgIGhvdXJzID0gaG91cnMgJSAxMjtcbiAgICAgICAgaG91cnMgPSAoaG91cnMpID8gaG91cnMgOiAxMjtcbiAgICAgICAgdmFyIG1pbnV0ZXMgPSBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgICAgICAgbWludXRlcyA9IChtaW51dGVzIDwgMTApID8gJzAnICsgbWludXRlcyA6IG1pbnV0ZXM7XG4gICAgICAgIHJldHVybiAnVG9kYXkgQCAnICsgaG91cnMgKyAnOicgKyBtaW51dGVzICsgJyAnICsgYW1wbTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRyYXdMb2NhdGlvbiA9IGZ1bmN0aW9uIChsb2NhdGlvbiwgb3B0cykge1xuICAgICAgICBpZiAodHlwZW9mIG9wdHMgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBvcHRzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgb3B0cy5pY29uID0gJy9pbWFnZXMvYmlrZS5wbmcnO1xuICAgICAgICBvcHRzLnBvc2l0aW9uID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvblswXSwgbG9jYXRpb25bMV0pO1xuICAgICAgICBvcHRzLm1hcCA9IG1hcDtcbiAgICAgICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5NYXJrZXIob3B0cyk7XG4gICAgfTtcblxuICAgICRzY29wZS5zZXRNYXBDZW50ZXIgPSBmdW5jdGlvbiAobG9jYXRpb25PYmopIHtcbiAgICAgICAgdmFyIGNlbnRlciA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobG9jYXRpb25PYmpbMF0ubGF0LCBsb2NhdGlvbk9ialsxXS5sbmcpO1xuICAgICAgICBNYXBGYWN0b3J5Lm1hcC5zZXRDZW50ZXIoY2VudGVyKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmluaXRNYXAoKTtcbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ01hcEZhY3RvcnknLCBmdW5jdGlvbigkaHR0cCl7XG5cdHJldHVybiB7XG5cdFx0c3RhdGlvbnM6IFtdLFxuXHRcdHVwZGF0ZXM6IHt9LFxuXHRcdG9yaWdpbjogbnVsbCxcblx0XHRkZXN0aW5hdGlvbjogbnVsbCxcblx0XHRtYXA6IG51bGwsXG5cdFx0dXNlckhvbWU6IG51bGwsXG5cdFx0bWFya2VyczogW10sXG5cdFx0Z2V0U3RhdGlvbnM6IGZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3N0YXRpb25zJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRnZXRVcGRhdGVzOiBmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS91cGRhdGUnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2U7XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdHNldENlbnRlcjogZnVuY3Rpb24gKGxvY2F0aW9uT2JqKSB7XG5cdFx0ICAgIHZhciBjZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxvY2F0aW9uT2JqWzBdLmxhdCwgbG9jYXRpb25PYmpbMV0ubG5nKTtcblx0XHQgICAgdGhpcy5tYXAuc2V0Q2VudGVyKGNlbnRlcik7XG5cdFx0fVxuXHR9O1xufSk7IiwiYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgIC5zdGF0ZSgnbWFwJywge1xuICAgICAgICAgICAgdXJsOiAnJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIi9hcHAvbWFwL21hcC5odG1sXCIsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTWFwQ29udHJvbGxlcicsXG4gICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgc3RhdGlvbnM6IGZ1bmN0aW9uIChNYXBGYWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXBGYWN0b3J5LmdldFN0YXRpb25zKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1cGRhdGVzOiBmdW5jdGlvbiAoTWFwRmFjdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWFwRmFjdG9yeS5nZXRVcGRhdGVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAuc3RhdGUoJ21hcC5wYW5lbCcsIHtcbiAgICAgICAgICAgIHVybDogJy9wYW5lbCcsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvcGFuZWwvcGFuZWwuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUGFuZWxDb250cm9sbGVyJ1xuICAgICAgICB9KTtcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIud2hlbignL2FwaS9hdXRoL2dvb2dsZScsICcvJyk7XG59KTtcbiIsImFwcC5jb250cm9sbGVyKCdQYW5lbENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBNYXBGYWN0b3J5KSB7XG4gICAgdmFyIG9yaWdpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWMtaW5wdXQtb3JpZ2luJyk7XG4gICAgdmFyIG9yaWdpbkJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuQXV0b2NvbXBsZXRlKG9yaWdpbik7XG4gICAgdmFyIGRlc3RpbmF0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhYy1pbnB1dC1kZXN0aW5hdGlvbicpO1xuICAgIHZhciBkZXN0aW5hdGlvbkJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuQXV0b2NvbXBsZXRlKGRlc3RpbmF0aW9uKTtcblxuICAgIG9yaWdpbkJveC5hZGRMaXN0ZW5lcigncGxhY2VfY2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTWFwRmFjdG9yeS5vcmlnaW4gPSBvcmlnaW5Cb3guZ2V0UGxhY2UoKTtcbiAgICB9KTtcblxuICAgIGRlc3RpbmF0aW9uQm94LmFkZExpc3RlbmVyKCdwbGFjZV9jaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBNYXBGYWN0b3J5LmRlc3RpbmF0aW9uID0gZGVzdGluYXRpb25Cb3guZ2V0UGxhY2UoKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIG5ld0xhdExuZ09iaihsb2NhdGlvbk9iaikge1xuICAgICAgICByZXR1cm4gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhcbiAgICAgICAgICAgIGxvY2F0aW9uT2JqLmdlb21ldHJ5LmxvY2F0aW9uLkcsXG4gICAgICAgICAgICBsb2NhdGlvbk9iai5nZW9tZXRyeS5sb2NhdGlvbi5LXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgICRzY29wZS5zZXRCb3VuZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XG4gICAgICAgIG9yaWdpbiA9IG5ld0xhdExuZ09iaihNYXBGYWN0b3J5Lm9yaWdpbik7XG4gICAgICAgIGRlc3RpbmF0aW9uID0gbmV3TGF0TG5nT2JqKE1hcEZhY3RvcnkuZGVzdGluYXRpb24pO1xuICAgICAgICBib3VuZHMuZXh0ZW5kKG9yaWdpbik7XG4gICAgICAgIGJvdW5kcy5leHRlbmQoZGVzdGluYXRpb24pO1xuICAgICAgICBNYXBGYWN0b3J5Lm1hcC5maXRCb3VuZHMoYm91bmRzKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmdldFRyYXZlbFRpbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpc3RhbmNlTWF0cml4U2VydmljZTtcbiAgICAgICAgdmFyIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdygpO1xuXG4gICAgICAgIHNlcnZpY2UuZ2V0RGlzdGFuY2VNYXRyaXgoe1xuICAgICAgICAgICAgb3JpZ2luczogW25ld0xhdExuZ09iaihNYXBGYWN0b3J5Lm9yaWdpbildLFxuICAgICAgICAgICAgZGVzdGluYXRpb25zOiBbbmV3TGF0TG5nT2JqKE1hcEZhY3RvcnkuZGVzdGluYXRpb24pXSxcbiAgICAgICAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLlRyYXZlbE1vZGUuQklDWUNMSU5HLFxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMuRGlzdGFuY2VNYXRyaXhTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2Uucm93c1swXS5lbGVtZW50c1swXS5kdXJhdGlvbi50ZXh0KTtcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93LnNldENvbnRlbnQocmVzcG9uc2Uucm93c1swXS5lbGVtZW50c1swXS5kdXJhdGlvbi50ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jYWxjQW5kRGlzcGxheVJvdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGlyZWN0aW9uc1NlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1NlcnZpY2U7XG4gICAgICAgICRzY29wZS5nZXRUcmF2ZWxUaW1lKCk7XG4gICAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKHtcbiAgICAgICAgICAgIG9yaWdpbjogbmV3TGF0TG5nT2JqKE1hcEZhY3Rvcnkub3JpZ2luKSxcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBuZXdMYXRMbmdPYmooTWFwRmFjdG9yeS5kZXN0aW5hdGlvbiksXG4gICAgICAgICAgICB0cmF2ZWxNb2RlOiBnb29nbGUubWFwcy5UcmF2ZWxNb2RlLkJJQ1lDTElORyxcbiAgICAgICAgICAgIHByb3ZpZGVSb3V0ZUFsdGVybmF0aXZlczogdHJ1ZVxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1N0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2Uucm91dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IChpID09PSAwKSA/ICdEb2RnZXJCbHVlJyA6ICdEYXJrR3JheSc7XG4gICAgICAgICAgICAgICAgICAgIHZhciB6SW5kZXggPSAoaSA9PT0gMCkgPyAxMDAwIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnMgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogTWFwRmFjdG9yeS5tYXAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zOiByZXNwb25zZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSW5kZXg6IGksXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2x5bGluZU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VDb2xvcjogY29sb3IsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogekluZGV4LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSBkaXJlY3Rpb25zLnNldFBhbmVsKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJlY3Rpb25zUGFuZWwnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ0RpcmVjdGlvbnMgcmVxdWVzdCBmYWlsZWQgZHVlIHRvOiAnLCBzdGF0dXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufSk7XG4iLCJhcHAuZGlyZWN0aXZlKCdmb290ZXInLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiBcIkVcIixcblx0XHR0ZW1wbGF0ZVVybDogXCIvZm9vdGVyLmh0bWxcIlxuXHR9O1xufSk7IiwiYXBwLmRpcmVjdGl2ZSgnbW9kYWwnLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6ICcvbW9kYWwuaHRtbCdcblx0fTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdOYXZiYXJDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgQXV0aEZhY3Rvcnkpe1xuXHQkc2NvcGUuc2hvd0xvZ2luID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIG1vZGFsID0gYW5ndWxhci5lbGVtZW50KCcjbG9naW5Nb2RhbCcpO1xuXHRcdGlmIChtb2RhbC5oYXNDbGFzcygnc2hvdycpKSB7XG5cdFx0XHRtb2RhbC5yZW1vdmVDbGFzcygnc2hvdycpO1xuXHRcdFx0bW9kYWwuYWRkQ2xhc3MoJ2hpZGUnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kYWwucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcblx0XHRcdG1vZGFsLmFkZENsYXNzKCdzaG93Jyk7XG5cdFx0fVxuXHR9O1xuXG5cdCRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0QXV0aEZhY3RvcnkubG9nb3V0KCk7XG5cdH07XG5cblx0JHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpe1xuXHRcdGFuZ3VsYXIuZWxlbWVudCgnI2xvZ2luTW9kYWwnKS5hZGRDbGFzcygnaGlkZScpO1xuXHRcdGFuZ3VsYXIuZWxlbWVudCgnI2xvZ2luTW9kYWwnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuXHR9O1xufSk7IiwiYXBwLmRpcmVjdGl2ZSgnbmF2YmFyJywgZnVuY3Rpb24oKXtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogJ0UnLFxuXHRcdHRlbXBsYXRlVXJsOiBcIi9uYXZiYXIuaHRtbFwiLFxuXHRcdGNvbnRyb2xsZXI6ICdOYXZiYXJDb250cm9sbGVyJ1xuXHR9O1xufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
