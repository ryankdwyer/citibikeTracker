'use strict';

var app = angular.module('citi', ['ui.router']);

app.controller('AuthController', function ($scope, AuthFactory, MapFactory) {
    var home = document.getElementById('pac-input-home');
    var homeBox = new google.maps.places.Autocomplete(home);
    var location;

    homeBox.addListener('place_changed', function () {
        location = parseLocation(homeBox.getPlace());
    });

    function parseLocation(placesObj) {
        return [{ lat: placesObj.geometry.location.G }, { lng: placesObj.geometry.location.K }];
    }

    $scope.signUp = function (credentials) {
        if (location) {
            credentials.home = location;
            AuthFactory.register(credentials).then(function () {
                $scope.closeModal();
            });
        } else {
            alert("Please enter a valid address");
        }
    };

    $scope.signInWithGoogle = function () {
        AuthFactory.signInWithGoogle().then(function (user) {
            $scope.closeModal();
            MapFactory.userHome = user.home;
            MapFactory.setCenter(MapFactory.userHome);
            alert('Welcome ' + user.name + '!');
        });
    };

    $scope.loginSubmit = function (credentials) {
        console.log($scope.loginForm);
        AuthFactory.login(credentials).then(function (user) {
            $scope.closeModal();
            MapFactory.userHome = user.home;
            console.log('user home', MapFactory.userHome);
            MapFactory.setCenter(MapFactory.userHome);
            alert('Welcome ' + user.name + '!');
        });
    };

    $scope.logOut = function () {
        AuthFactory.logOut();
    };

    $scope.showLogin = function () {
        var modal = angular.element('#loginModal');
        modal.removeClass('hide');
        modal.addClass('show');
    };

    $scope.showSignup = function () {
        var modal = angular.element('#signupModal');
        modal.removeClass('hide');
        modal.addClass('show');
    };

    $scope.closeModal = function () {
        angular.element('#loginModal').addClass('hide');
        angular.element('#loginModal').removeClass('show');
        angular.element('#signupModal').addClass('hide');
        angular.element('#signupModal').removeClass('show');
    };
});

app.factory('AuthFactory', function ($http, $state) {
    function toData(response) {
        return response.data;
    }
    return {
        login: function login(credentials) {
            return $http.post('/api/login', credentials).then(toData);
        },
        register: function register(credentials) {
            return $http.post('api/register', credentials).then(toData);
        },
        logout: function logout() {
            return $http.post('api/logout').then(toData);
        },
        signInWithGoogle: function signInWithGoogle() {
            return $http.get('api/auth/google').then(function (response) {
                return response.data;
            });
        }
    };
});

app.directive('login', function () {
    return {
        restrict: 'E',
        templateUrl: '/app/auth/auth.html',
        controller: 'AuthController'
    };
});

app.controller('PanelController', function ($scope, MapFactory) {
    var origin = document.getElementById('pac-input-origin');
    var originBox = new google.maps.places.Autocomplete(origin);
    var destination = document.getElementById('pac-input-destination');
    var destinationBox = new google.maps.places.Autocomplete(destination);

    originBox.addListener('place_changed', function () {
        MapFactory.origin = originBox.getPlace();
    });

    destinationBox.addListener('place_changed', function () {
        MapFactory.destination = destinationBox.getPlace();
    });

    function newLatLngObj(locationObj) {
        return new google.maps.LatLng(locationObj.geometry.location.G, locationObj.geometry.location.K);
    }

    $scope.setBounds = function () {
        var bounds = new google.maps.LatLngBounds();
        origin = newLatLngObj(MapFactory.origin);
        destination = newLatLngObj(MapFactory.destination);
        bounds.extend(origin);
        bounds.extend(destination);
        MapFactory.map.fitBounds(bounds);
    };

    $scope.getTravelTime = function () {
        var service = new google.maps.DistanceMatrixService();
        var infowindow = new google.maps.InfoWindow();

        service.getDistanceMatrix({
            origins: [newLatLngObj(MapFactory.origin)],
            destinations: [newLatLngObj(MapFactory.destination)],
            travelMode: google.maps.TravelMode.BICYCLING
        }, function (response, status) {
            if (status === google.maps.DistanceMatrixStatus.OK) {
                console.log(response);
                console.log(response.rows[0].elements[0].duration.text);
                infowindow.setContent(response.rows[0].elements[0].duration.text);
            }
        });
    };

    $scope.calcAndDisplayRoute = function () {
        var directionsService = new google.maps.DirectionsService();
        $scope.getTravelTime();
        directionsService.route({
            origin: newLatLngObj(MapFactory.origin),
            destination: newLatLngObj(MapFactory.destination),
            travelMode: google.maps.TravelMode.BICYCLING,
            provideRouteAlternatives: true
        }, function (response, status) {
            if (status === google.maps.DirectionsStatus.OK) {
                for (var i = 0; i < response.routes.length; i++) {
                    var color = i === 0 ? 'DodgerBlue' : 'DarkGray';
                    var zIndex = i === 0 ? 1000 : null;
                    var directions = new google.maps.DirectionsRenderer({
                        map: MapFactory.map,
                        directions: response,
                        routeIndex: i,
                        polylineOptions: {
                            strokeColor: color,
                            zIndex: zIndex,
                            strokeWeight: 5
                        }
                    });
                    if (i === 0) directions.setPanel(document.getElementById('directionsPanel'));
                }
            } else {
                window.alert('Directions request failed due to: ', status);
            }
        });
    };
});

app.controller('MapController', function ($scope, MapFactory, stations, updates) {
    var map;
    $scope.initMap = function () {
        var home = {
            lat: 40.729546,
            lng: -73.98569
        };

        map = new google.maps.Map(angular.element('#map-canvas')[0], {
            center: home,
            zoom: 13
        });
        MapFactory.map = map;

        var bikeLayer = new google.maps.BicyclingLayer();
        bikeLayer.setMap(map);

        var bounds = new google.maps.LatLngBounds();

        var infowindow = new google.maps.InfoWindow();
        map.addListener('click', function () {
            infowindow.close();
        });

        stations.data.forEach(function (el) {
            var marker = $scope.drawLocation([el.latitude, el.longitude], {});
            MapFactory.markers.push(marker);
            marker.addListener('click', function () {
                infowindow.close();
                contentString = "<p>Station: " + el.label + "</p>" + "<p>Bikes: " + updates.data[el.stationId][0] + '</p>' + "<p>Docks: " + updates.data[el.stationId][1] + '</p>' + "<p>Active: " + el.status + '</p>' + "<p>Last Update: " + $scope.setDate(updates.data[el.stationId][2]) + '</p>';
                infowindow.setContent(contentString);
                infowindow.open(map, marker);
            });
        });
    };

    $scope.updater = function () {
        MapFactory.getUpdates().then(function (response) {
            updates = response;
            $scope.initMap();
        });
    };

    $scope.removeMarkers = function () {
        MapFactory.markers.forEach(function (el) {
            el.setMap(null);
        });
    };

    $scope.showMarkers = function () {
        MapFactory.markers.forEach(function (el) {
            el.setMap(MapFactory.map);
        });
    };

    $scope.setDate = function (unix) {
        var date = new Date(unix * 1000);
        var hours = date.getHours();
        var ampm = date.getHours() > 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        var minutes = date.getMinutes();
        minutes = minutes < 10 ? '0' + minutes : minutes;
        return 'Today @ ' + hours + ':' + minutes + ' ' + ampm;
    };

    $scope.drawLocation = function (location, opts) {
        if (typeof opts !== 'object') {
            opts = {};
        }
        opts.icon = '/images/bike.png';
        opts.position = new google.maps.LatLng(location[0], location[1]);
        opts.map = map;
        return new google.maps.Marker(opts);
    };

    $scope.setMapCenter = function (locationObj) {
        var center = new google.maps.LatLng(locationObj[0].lat, locationObj[1].lng);
        MapFactory.map.setCenter(center);
    };

    $scope.initMap();
});

app.factory('MapFactory', function ($http) {
    return {
        stations: [],
        updates: {},
        origin: null,
        destination: null,
        map: null,
        userHome: null,
        markers: [],
        getStations: function getStations() {
            return $http.get('/api/stations').then(function (response) {
                return response;
            });
        },
        getUpdates: function getUpdates() {
            return $http.get('/api/update').then(function (response) {
                return response;
            });
        },
        setCenter: function setCenter(locationObj) {
            var center = new google.maps.LatLng(locationObj[0].lat, locationObj[1].lng);
            this.map.setCenter(center);
        }
    };
});
app.config(function ($stateProvider, $urlRouterProvider) {
    $stateProvider.state('map', {
        url: '',
        templateUrl: "/app/map/map.html",
        controller: 'MapController',
        resolve: {
            stations: function stations(MapFactory) {
                return MapFactory.getStations();
            },
            updates: function updates(MapFactory) {
                return MapFactory.getUpdates();
            }
        }
    });
    $stateProvider.state('map.panel', {
        url: '/panel',
        templateUrl: '/app/panel/panel.html',
        controller: 'PanelController'
    });
    $urlRouterProvider.when('/api/auth/google', '/');
});

app.directive('footer', function () {
    return {
        restrict: "E",
        templateUrl: "/footer.html"
    };
});
app.directive('modal', function () {
    return {
        restrict: 'E',
        templateUrl: '/modal.html'
    };
});
app.controller('NavbarController', function ($scope, $http, AuthFactory) {
    $scope.showLogin = function () {
        var modal = angular.element('#loginModal');
        if (modal.hasClass('show')) {
            modal.removeClass('show');
            modal.addClass('hide');
        } else {
            modal.removeClass('hide');
            modal.addClass('show');
        }
    };

    $scope.logout = function () {
        AuthFactory.logout();
    };

    $scope.closeModal = function () {
        angular.element('#loginModal').addClass('hide');
        angular.element('#loginModal').removeClass('show');
    };
});
app.directive('navbar', function () {
    return {
        restrict: 'E',
        templateUrl: "/navbar.html",
        controller: 'NavbarController'
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC9hdXRoL2F1dGguY29udHJvbGxlci5qcyIsImFwcC9hdXRoL2F1dGguZmFjdG9yeS5qcyIsImFwcC9hdXRoL2F1dGguanMiLCJhcHAvcGFuZWwvcGFuZWwuY29udHJvbGxlci5qcyIsImFwcC9tYXAvbWFwLmNvbnRyb2xsZXIuanMiLCJhcHAvbWFwL21hcC5mYWN0b3J5LmpzIiwiYXBwL21hcC9tYXAuc3RhdGUuanMiLCJjb21wb25lbnRzL2Zvb3Rlci9mb290ZXIuanMiLCJjb21wb25lbnRzL21vZGFsL21vZGFsLmpzIiwiY29tcG9uZW50cy9uYXZiYXIvbmF2YmFyLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL25hdmJhci9uYXZiYXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBLEdBQUEsR0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUE7O0FDQUEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxnQkFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFdBQUEsRUFBQSxVQUFBLEVBQUE7QUFDQSxRQUFBLElBQUEsR0FBQSxRQUFBLENBQUEsY0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQTtBQUNBLFFBQUEsT0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsWUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsUUFBQSxRQUFBLENBQUE7O0FBRUEsV0FBQSxDQUFBLFdBQUEsQ0FBQSxlQUFBLEVBQUEsWUFBQTtBQUNBLGdCQUFBLEdBQUEsYUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLEVBQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQSxDQUFBOztBQUVBLGFBQUEsYUFBQSxDQUFBLFNBQUEsRUFBQTtBQUNBLGVBQUEsQ0FDQSxFQUFBLEdBQUEsRUFBQSxTQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEVBQUEsRUFDQSxFQUFBLEdBQUEsRUFBQSxTQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FDQSxDQUFBO0tBQ0E7O0FBRUEsVUFBQSxDQUFBLE1BQUEsR0FBQSxVQUFBLFdBQUEsRUFBQTtBQUNBLFlBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsQ0FBQSxJQUFBLEdBQUEsUUFBQSxDQUFBO0FBQ0EsdUJBQUEsQ0FBQSxRQUFBLENBQUEsV0FBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFlBQUE7QUFDQSxzQkFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO2FBQ0EsQ0FBQSxDQUFBO1NBQ0EsTUFBQTtBQUNBLGlCQUFBLENBQUEsOEJBQUEsQ0FBQSxDQUFBO1NBQ0E7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxnQkFBQSxHQUFBLFlBQUE7QUFDQSxtQkFBQSxDQUFBLGdCQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxrQkFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxRQUFBLEdBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLHNCQUFBLENBQUEsU0FBQSxDQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsVUFBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxXQUFBLEdBQUEsVUFBQSxXQUFBLEVBQUE7QUFDQSxlQUFBLENBQUEsR0FBQSxDQUFBLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQTtBQUNBLG1CQUFBLENBQUEsS0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLElBQUEsRUFBQTtBQUNBLGtCQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxzQkFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLENBQUEsSUFBQSxDQUFBO0FBQ0EsbUJBQUEsQ0FBQSxHQUFBLENBQUEsV0FBQSxFQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLHNCQUFBLENBQUEsU0FBQSxDQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsVUFBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxNQUFBLEdBQUEsWUFBQTtBQUNBLG1CQUFBLENBQUEsTUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxTQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsS0FBQSxHQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7QUFDQSxhQUFBLENBQUEsV0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsYUFBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLFVBQUEsR0FBQSxZQUFBO0FBQ0EsWUFBQSxLQUFBLEdBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQTtBQUNBLGFBQUEsQ0FBQSxXQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxhQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsVUFBQSxHQUFBLFlBQUE7QUFDQSxlQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLGVBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUEsV0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsZUFBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxlQUFBLENBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBLFdBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDeEVBLEdBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxFQUFBLFVBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQTtBQUNBLGFBQUEsTUFBQSxDQUFBLFFBQUEsRUFBQTtBQUNBLGVBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQTtLQUNBO0FBQ0EsV0FBQTtBQUNBLGFBQUEsRUFBQSxlQUFBLFdBQUEsRUFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsWUFBQSxFQUFBLFdBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtTQUNBO0FBQ0EsZ0JBQUEsRUFBQSxrQkFBQSxXQUFBLEVBQUE7QUFDQSxtQkFBQSxLQUFBLENBQUEsSUFBQSxDQUFBLGNBQUEsRUFBQSxXQUFBLENBQUEsQ0FDQSxJQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7U0FDQTtBQUNBLGNBQUEsRUFBQSxrQkFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsWUFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1NBQ0E7QUFDQSx3QkFBQSxFQUFBLDRCQUFBO0FBQ0EsbUJBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxpQkFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBO0tBQ0EsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUN4QkEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxPQUFBLEVBQUEsWUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEdBQUE7QUFDQSxtQkFBQSxFQUFBLHFCQUFBO0FBQ0Esa0JBQUEsRUFBQSxnQkFBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDTkEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxpQkFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFVBQUEsRUFBQTtBQUNBLFFBQUEsTUFBQSxHQUFBLFFBQUEsQ0FBQSxjQUFBLENBQUEsa0JBQUEsQ0FBQSxDQUFBO0FBQ0EsUUFBQSxTQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxZQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxRQUFBLFdBQUEsR0FBQSxRQUFBLENBQUEsY0FBQSxDQUFBLHVCQUFBLENBQUEsQ0FBQTtBQUNBLFFBQUEsY0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsWUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUVBLGFBQUEsQ0FBQSxXQUFBLENBQUEsZUFBQSxFQUFBLFlBQUE7QUFDQSxrQkFBQSxDQUFBLE1BQUEsR0FBQSxTQUFBLENBQUEsUUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBLENBQUE7O0FBRUEsa0JBQUEsQ0FBQSxXQUFBLENBQUEsZUFBQSxFQUFBLFlBQUE7QUFDQSxrQkFBQSxDQUFBLFdBQUEsR0FBQSxjQUFBLENBQUEsUUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBLENBQUE7O0FBRUEsYUFBQSxZQUFBLENBQUEsV0FBQSxFQUFBO0FBQ0EsZUFBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUNBLFdBQUEsQ0FBQSxRQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsRUFDQSxXQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLENBQ0EsQ0FBQTtLQUNBOztBQUVBLFVBQUEsQ0FBQSxTQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsTUFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQTtBQUNBLGNBQUEsR0FBQSxZQUFBLENBQUEsVUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsbUJBQUEsR0FBQSxZQUFBLENBQUEsVUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBO0FBQ0EsY0FBQSxDQUFBLE1BQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsV0FBQSxDQUFBLENBQUE7QUFDQSxrQkFBQSxDQUFBLEdBQUEsQ0FBQSxTQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxhQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsT0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxxQkFBQSxFQUFBLENBQUE7QUFDQSxZQUFBLFVBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7O0FBRUEsZUFBQSxDQUFBLGlCQUFBLENBQUE7QUFDQSxtQkFBQSxFQUFBLENBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLHdCQUFBLEVBQUEsQ0FBQSxZQUFBLENBQUEsVUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsRUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsQ0FBQSxTQUFBO1NBQ0EsRUFBQSxVQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUE7QUFDQSxnQkFBQSxNQUFBLEtBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxvQkFBQSxDQUFBLEVBQUEsRUFBQTtBQUNBLHVCQUFBLENBQUEsR0FBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBO0FBQ0EsdUJBQUEsQ0FBQSxHQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsMEJBQUEsQ0FBQSxVQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO2FBQ0E7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxtQkFBQSxHQUFBLFlBQUE7QUFDQSxZQUFBLGlCQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLGlCQUFBLEVBQUEsQ0FBQTtBQUNBLGNBQUEsQ0FBQSxhQUFBLEVBQUEsQ0FBQTtBQUNBLHlCQUFBLENBQUEsS0FBQSxDQUFBO0FBQ0Esa0JBQUEsRUFBQSxZQUFBLENBQUEsVUFBQSxDQUFBLE1BQUEsQ0FBQTtBQUNBLHVCQUFBLEVBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxXQUFBLENBQUE7QUFDQSxzQkFBQSxFQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsVUFBQSxDQUFBLFNBQUE7QUFDQSxvQ0FBQSxFQUFBLElBQUE7U0FDQSxFQUFBLFVBQUEsUUFBQSxFQUFBLE1BQUEsRUFBQTtBQUNBLGdCQUFBLE1BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLGdCQUFBLENBQUEsRUFBQSxFQUFBO0FBQ0EscUJBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLEVBQUEsRUFBQTtBQUNBLHdCQUFBLEtBQUEsR0FBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLFlBQUEsR0FBQSxVQUFBLENBQUE7QUFDQSx3QkFBQSxNQUFBLEdBQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxJQUFBLEdBQUEsSUFBQSxDQUFBO0FBQ0Esd0JBQUEsVUFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxrQkFBQSxDQUFBO0FBQ0EsMkJBQUEsRUFBQSxVQUFBLENBQUEsR0FBQTtBQUNBLGtDQUFBLEVBQUEsUUFBQTtBQUNBLGtDQUFBLEVBQUEsQ0FBQTtBQUNBLHVDQUFBLEVBQUE7QUFDQSx1Q0FBQSxFQUFBLEtBQUE7QUFDQSxrQ0FBQSxFQUFBLE1BQUE7QUFDQSx3Q0FBQSxFQUFBLENBQUE7eUJBQ0E7cUJBQ0EsQ0FBQSxDQUFBO0FBQ0Esd0JBQUEsQ0FBQSxLQUFBLENBQUEsRUFBQSxVQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxjQUFBLENBQUEsaUJBQUEsQ0FBQSxDQUFBLENBQUE7aUJBQ0E7YUFDQSxNQUFBO0FBQ0Esc0JBQUEsQ0FBQSxLQUFBLENBQUEsb0NBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQTthQUNBO1NBQ0EsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUM3RUEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxlQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsVUFBQSxFQUFBLFFBQUEsRUFBQSxPQUFBLEVBQUE7QUFDQSxRQUFBLEdBQUEsQ0FBQTtBQUNBLFVBQUEsQ0FBQSxPQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsSUFBQSxHQUFBO0FBQ0EsZUFBQSxFQUFBLFNBQUE7QUFDQSxlQUFBLEVBQUEsQ0FBQSxRQUFBO1NBQ0EsQ0FBQTs7QUFFQSxXQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxFQUFBO0FBQ0Esa0JBQUEsRUFBQSxJQUFBO0FBQ0EsZ0JBQUEsRUFBQSxFQUFBO1NBQ0EsQ0FBQSxDQUFBO0FBQ0Esa0JBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBOztBQUVBLFlBQUEsU0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxjQUFBLEVBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsTUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBOztBQUVBLFlBQUEsTUFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQTs7QUFFQSxZQUFBLFVBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxXQUFBLENBQUEsV0FBQSxDQUFBLE9BQUEsRUFBQSxZQUFBO0FBQ0Esc0JBQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQTtTQUNBLENBQUEsQ0FBQTs7QUFFQSxnQkFBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxFQUFBLEVBQUE7QUFDQSxnQkFBQSxNQUFBLEdBQUEsTUFBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxRQUFBLEVBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0Esa0JBQUEsQ0FBQSxXQUFBLENBQUEsT0FBQSxFQUFBLFlBQUE7QUFDQSwwQkFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO0FBQ0EsNkJBQUEsR0FBQSxjQUFBLEdBQUEsRUFBQSxDQUFBLEtBQUEsR0FBQSxNQUFBLEdBQ0EsWUFBQSxHQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLE1BQUEsR0FDQSxZQUFBLEdBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsTUFBQSxHQUNBLGFBQUEsR0FBQSxFQUFBLENBQUEsTUFBQSxHQUFBLE1BQUEsR0FDQSxrQkFBQSxHQUFBLE1BQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQSxNQUFBLENBQUE7QUFDQSwwQkFBQSxDQUFBLFVBQUEsQ0FBQSxhQUFBLENBQUEsQ0FBQTtBQUNBLDBCQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLE9BQUEsR0FBQSxZQUFBO0FBQ0Esa0JBQUEsQ0FBQSxVQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxtQkFBQSxHQUFBLFFBQUEsQ0FBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxFQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxhQUFBLEdBQUEsWUFBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxXQUFBLEdBQUEsWUFBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsVUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO1NBQ0EsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsT0FBQSxHQUFBLFVBQUEsSUFBQSxFQUFBO0FBQ0EsWUFBQSxJQUFBLEdBQUEsSUFBQSxJQUFBLENBQUEsSUFBQSxHQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsWUFBQSxLQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxDQUFBO0FBQ0EsWUFBQSxJQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxJQUFBLEdBQUEsSUFBQSxDQUFBO0FBQ0EsYUFBQSxHQUFBLEtBQUEsR0FBQSxFQUFBLENBQUE7QUFDQSxhQUFBLEdBQUEsS0FBQSxHQUFBLEtBQUEsR0FBQSxFQUFBLENBQUE7QUFDQSxZQUFBLE9BQUEsR0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxlQUFBLEdBQUEsT0FBQSxHQUFBLEVBQUEsR0FBQSxHQUFBLEdBQUEsT0FBQSxHQUFBLE9BQUEsQ0FBQTtBQUNBLGVBQUEsVUFBQSxHQUFBLEtBQUEsR0FBQSxHQUFBLEdBQUEsT0FBQSxHQUFBLEdBQUEsR0FBQSxJQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxZQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUEsSUFBQSxFQUFBO0FBQ0EsWUFBQSxPQUFBLElBQUEsS0FBQSxRQUFBLEVBQUE7QUFDQSxnQkFBQSxHQUFBLEVBQUEsQ0FBQTtTQUNBO0FBQ0EsWUFBQSxDQUFBLElBQUEsR0FBQSxrQkFBQSxDQUFBO0FBQ0EsWUFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQTtBQUNBLFlBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBO0FBQ0EsZUFBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsWUFBQSxHQUFBLFVBQUEsV0FBQSxFQUFBO0FBQ0EsWUFBQSxNQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQSxFQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtBQUNBLGtCQUFBLENBQUEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLE9BQUEsRUFBQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQ3ZGQSxHQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsRUFBQSxVQUFBLEtBQUEsRUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEVBQUE7QUFDQSxlQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsRUFBQSxJQUFBO0FBQ0EsbUJBQUEsRUFBQSxJQUFBO0FBQ0EsV0FBQSxFQUFBLElBQUE7QUFDQSxnQkFBQSxFQUFBLElBQUE7QUFDQSxlQUFBLEVBQUEsRUFBQTtBQUNBLG1CQUFBLEVBQUEsdUJBQUE7QUFDQSxtQkFBQSxLQUFBLENBQUEsR0FBQSxDQUFBLGVBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLHVCQUFBLFFBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBO0FBQ0Esa0JBQUEsRUFBQSxzQkFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsYUFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsUUFBQSxDQUFBO2FBQ0EsQ0FBQSxDQUFBO1NBQ0E7QUFDQSxpQkFBQSxF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ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnY2l0aScsIFsndWkucm91dGVyJ10pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ0F1dGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgQXV0aEZhY3RvcnksIE1hcEZhY3RvcnkpIHtcbiAgICB2YXIgaG9tZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWMtaW5wdXQtaG9tZScpO1xuICAgIHZhciBob21lQm94ID0gbmV3IGdvb2dsZS5tYXBzLnBsYWNlcy5BdXRvY29tcGxldGUoaG9tZSk7XG4gICAgdmFyIGxvY2F0aW9uO1xuXG4gICAgaG9tZUJveC5hZGRMaXN0ZW5lcigncGxhY2VfY2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9jYXRpb24gPSBwYXJzZUxvY2F0aW9uKGhvbWVCb3guZ2V0UGxhY2UoKSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwYXJzZUxvY2F0aW9uKHBsYWNlc09iaikge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAge2xhdDogcGxhY2VzT2JqLmdlb21ldHJ5LmxvY2F0aW9uLkd9LFxuICAgICAgICAgICAge2xuZzogcGxhY2VzT2JqLmdlb21ldHJ5LmxvY2F0aW9uLkt9XG4gICAgICAgICAgICBdO1xuICAgIH1cblxuICAgICRzY29wZS5zaWduVXAgPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKGxvY2F0aW9uKSB7XG4gICAgICAgICAgICBjcmVkZW50aWFscy5ob21lID0gbG9jYXRpb247XG4gICAgICAgICAgICBBdXRoRmFjdG9yeS5yZWdpc3RlcihjcmVkZW50aWFscylcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWxlcnQoXCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBhZGRyZXNzXCIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5zaWduSW5XaXRoR29vZ2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBBdXRoRmFjdG9yeS5zaWduSW5XaXRoR29vZ2xlKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcil7XG4gICAgICAgICAgICAkc2NvcGUuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgTWFwRmFjdG9yeS51c2VySG9tZSA9IHVzZXIuaG9tZTtcbiAgICAgICAgICAgIE1hcEZhY3Rvcnkuc2V0Q2VudGVyKE1hcEZhY3RvcnkudXNlckhvbWUpO1xuICAgICAgICAgICAgYWxlcnQoJ1dlbGNvbWUgJyArIHVzZXIubmFtZSArICchJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUubG9naW5TdWJtaXQgPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmxvZ2luRm9ybSk7XG4gICAgICAgIEF1dGhGYWN0b3J5LmxvZ2luKGNyZWRlbnRpYWxzKVxuICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKXtcbiAgICAgICAgICAgICRzY29wZS5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICBNYXBGYWN0b3J5LnVzZXJIb21lID0gdXNlci5ob21lO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXIgaG9tZScsIE1hcEZhY3RvcnkudXNlckhvbWUpO1xuICAgICAgICAgICAgTWFwRmFjdG9yeS5zZXRDZW50ZXIoTWFwRmFjdG9yeS51c2VySG9tZSk7XG4gICAgICAgICAgICBhbGVydCgnV2VsY29tZSAnICsgdXNlci5uYW1lICsgJyEnKTtcbiAgICAgICAgfSk7IFxuICAgIH07XG5cbiAgICAkc2NvcGUubG9nT3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBBdXRoRmFjdG9yeS5sb2dPdXQoKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNob3dMb2dpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1vZGFsID0gYW5ndWxhci5lbGVtZW50KCcjbG9naW5Nb2RhbCcpO1xuICAgICAgICBtb2RhbC5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICBtb2RhbC5hZGRDbGFzcygnc2hvdycpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2hvd1NpZ251cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1vZGFsID0gYW5ndWxhci5lbGVtZW50KCcjc2lnbnVwTW9kYWwnKTtcbiAgICAgICAgbW9kYWwucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgbW9kYWwuYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI2xvZ2luTW9kYWwnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNsb2dpbk1vZGFsJykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjc2lnbnVwTW9kYWwnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNzaWdudXBNb2RhbCcpLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgfTtcbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ0F1dGhGYWN0b3J5JywgZnVuY3Rpb24gKCRodHRwLCAkc3RhdGUpIHtcbiAgICBmdW5jdGlvbiB0b0RhdGEocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGxvZ2luOiBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL2xvZ2luJywgY3JlZGVudGlhbHMpXG4gICAgICAgICAgICAgICAgLnRoZW4odG9EYXRhKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVnaXN0ZXI6IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJ2FwaS9yZWdpc3RlcicsIGNyZWRlbnRpYWxzKVxuICAgICAgICAgICAgICAgIC50aGVuKHRvRGF0YSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvZ291dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJ2FwaS9sb2dvdXQnKVxuICAgICAgICAgICAgICAgIC50aGVuKHRvRGF0YSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNpZ25JbldpdGhHb29nbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJ2FwaS9hdXRoL2dvb2dsZScpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn0pO1xuIiwiYXBwLmRpcmVjdGl2ZSgnbG9naW4nLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6ICcvYXBwL2F1dGgvYXV0aC5odG1sJyxcblx0XHRjb250cm9sbGVyOiAnQXV0aENvbnRyb2xsZXInXG5cdH07XG59KTsiLCJhcHAuY29udHJvbGxlcignUGFuZWxDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgTWFwRmFjdG9yeSkge1xuICAgIHZhciBvcmlnaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFjLWlucHV0LW9yaWdpbicpO1xuICAgIHZhciBvcmlnaW5Cb3ggPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZShvcmlnaW4pO1xuICAgIHZhciBkZXN0aW5hdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWMtaW5wdXQtZGVzdGluYXRpb24nKTtcbiAgICB2YXIgZGVzdGluYXRpb25Cb3ggPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZShkZXN0aW5hdGlvbik7XG5cbiAgICBvcmlnaW5Cb3guYWRkTGlzdGVuZXIoJ3BsYWNlX2NoYW5nZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIE1hcEZhY3Rvcnkub3JpZ2luID0gb3JpZ2luQm94LmdldFBsYWNlKCk7XG4gICAgfSk7XG5cbiAgICBkZXN0aW5hdGlvbkJveC5hZGRMaXN0ZW5lcigncGxhY2VfY2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTWFwRmFjdG9yeS5kZXN0aW5hdGlvbiA9IGRlc3RpbmF0aW9uQm94LmdldFBsYWNlKCk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBuZXdMYXRMbmdPYmoobG9jYXRpb25PYmopIHtcbiAgICAgICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5MYXRMbmcoXG4gICAgICAgICAgICBsb2NhdGlvbk9iai5nZW9tZXRyeS5sb2NhdGlvbi5HLFxuICAgICAgICAgICAgbG9jYXRpb25PYmouZ2VvbWV0cnkubG9jYXRpb24uS1xuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAkc2NvcGUuc2V0Qm91bmRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xuICAgICAgICBvcmlnaW4gPSBuZXdMYXRMbmdPYmooTWFwRmFjdG9yeS5vcmlnaW4pO1xuICAgICAgICBkZXN0aW5hdGlvbiA9IG5ld0xhdExuZ09iaihNYXBGYWN0b3J5LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgYm91bmRzLmV4dGVuZChvcmlnaW4pO1xuICAgICAgICBib3VuZHMuZXh0ZW5kKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgTWFwRmFjdG9yeS5tYXAuZml0Qm91bmRzKGJvdW5kcyk7XG4gICAgfTtcblxuICAgICRzY29wZS5nZXRUcmF2ZWxUaW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXN0YW5jZU1hdHJpeFNlcnZpY2U7XG4gICAgICAgIHZhciBpbmZvd2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coKTtcblxuICAgICAgICBzZXJ2aWNlLmdldERpc3RhbmNlTWF0cml4KHtcbiAgICAgICAgICAgIG9yaWdpbnM6IFtuZXdMYXRMbmdPYmooTWFwRmFjdG9yeS5vcmlnaW4pXSxcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uczogW25ld0xhdExuZ09iaihNYXBGYWN0b3J5LmRlc3RpbmF0aW9uKV0sXG4gICAgICAgICAgICB0cmF2ZWxNb2RlOiBnb29nbGUubWFwcy5UcmF2ZWxNb2RlLkJJQ1lDTElORyxcbiAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkRpc3RhbmNlTWF0cml4U3RhdHVzLk9LKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnJvd3NbMF0uZWxlbWVudHNbMF0uZHVyYXRpb24udGV4dCk7XG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5zZXRDb250ZW50KHJlc3BvbnNlLnJvd3NbMF0uZWxlbWVudHNbMF0uZHVyYXRpb24udGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuY2FsY0FuZERpc3BsYXlSb3V0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRpcmVjdGlvbnNTZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTZXJ2aWNlO1xuICAgICAgICAkc2NvcGUuZ2V0VHJhdmVsVGltZSgpO1xuICAgICAgICBkaXJlY3Rpb25zU2VydmljZS5yb3V0ZSh7XG4gICAgICAgICAgICBvcmlnaW46IG5ld0xhdExuZ09iaihNYXBGYWN0b3J5Lm9yaWdpbiksXG4gICAgICAgICAgICBkZXN0aW5hdGlvbjogbmV3TGF0TG5nT2JqKE1hcEZhY3RvcnkuZGVzdGluYXRpb24pLFxuICAgICAgICAgICAgdHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuVHJhdmVsTW9kZS5CSUNZQ0xJTkcsXG4gICAgICAgICAgICBwcm92aWRlUm91dGVBbHRlcm5hdGl2ZXM6IHRydWVcbiAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLnJvdXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSAoaSA9PT0gMCkgPyAnRG9kZ2VyQmx1ZScgOiAnRGFya0dyYXknO1xuICAgICAgICAgICAgICAgICAgICB2YXIgekluZGV4ID0gKGkgPT09IDApID8gMTAwMCA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXJlY3Rpb25zID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXA6IE1hcEZhY3RvcnkubWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uczogcmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUluZGV4OiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9seWxpbmVPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlQ29sb3I6IGNvbG9yLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IHpJbmRleCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiA1XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkgZGlyZWN0aW9ucy5zZXRQYW5lbChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyZWN0aW9uc1BhbmVsJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCdEaXJlY3Rpb25zIHJlcXVlc3QgZmFpbGVkIGR1ZSB0bzogJywgc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbn0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ01hcENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBNYXBGYWN0b3J5LCBzdGF0aW9ucywgdXBkYXRlcykge1xuICAgIHZhciBtYXA7XG4gICAgJHNjb3BlLmluaXRNYXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBob21lID0ge1xuICAgICAgICAgICAgbGF0OiA0MC43Mjk1NDYsXG4gICAgICAgICAgICBsbmc6IC03My45ODU2OVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChhbmd1bGFyLmVsZW1lbnQoJyNtYXAtY2FudmFzJylbMF0sIHtcbiAgICAgICAgICAgIGNlbnRlcjogaG9tZSxcbiAgICAgICAgICAgIHpvb206IDEzXG4gICAgICAgIH0pO1xuICAgICAgICBNYXBGYWN0b3J5Lm1hcCA9IG1hcDtcblxuICAgICAgICB2YXIgYmlrZUxheWVyID0gbmV3IGdvb2dsZS5tYXBzLkJpY3ljbGluZ0xheWVyKCk7XG4gICAgICAgIGJpa2VMYXllci5zZXRNYXAobWFwKTtcblxuICAgICAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xuICAgICAgICBcbiAgICAgICAgdmFyIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdygpO1xuICAgICAgICBtYXAuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaW5mb3dpbmRvdy5jbG9zZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHN0YXRpb25zLmRhdGEuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIHZhciBtYXJrZXIgPSAkc2NvcGUuZHJhd0xvY2F0aW9uKFtlbC5sYXRpdHVkZSwgZWwubG9uZ2l0dWRlXSwge30pO1xuICAgICAgICAgICAgTWFwRmFjdG9yeS5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgICAgIG1hcmtlci5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIGNvbnRlbnRTdHJpbmcgPSBcIjxwPlN0YXRpb246IFwiICsgZWwubGFiZWwgKyBcIjwvcD5cIiArXG4gICAgICAgICAgICAgICAgICAgIFwiPHA+QmlrZXM6IFwiICsgdXBkYXRlcy5kYXRhW2VsLnN0YXRpb25JZF1bMF0gKyAnPC9wPicgK1xuICAgICAgICAgICAgICAgICAgICBcIjxwPkRvY2tzOiBcIiArIHVwZGF0ZXMuZGF0YVtlbC5zdGF0aW9uSWRdWzFdICsgJzwvcD4nICtcbiAgICAgICAgICAgICAgICAgICAgXCI8cD5BY3RpdmU6IFwiICsgZWwuc3RhdHVzICsgJzwvcD4nICtcbiAgICAgICAgICAgICAgICAgICAgXCI8cD5MYXN0IFVwZGF0ZTogXCIgKyAkc2NvcGUuc2V0RGF0ZSh1cGRhdGVzLmRhdGFbZWwuc3RhdGlvbklkXVsyXSkgKyAnPC9wPic7XG4gICAgICAgICAgICAgICAgaW5mb3dpbmRvdy5zZXRDb250ZW50KGNvbnRlbnRTdHJpbmcpO1xuICAgICAgICAgICAgICAgIGluZm93aW5kb3cub3BlbihtYXAsIG1hcmtlcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS51cGRhdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBNYXBGYWN0b3J5LmdldFVwZGF0ZXMoKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlcyA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICRzY29wZS5pbml0TWFwKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnJlbW92ZU1hcmtlcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIE1hcEZhY3RvcnkubWFya2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgZWwuc2V0TWFwKG51bGwpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNob3dNYXJrZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBNYXBGYWN0b3J5Lm1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIGVsLnNldE1hcChNYXBGYWN0b3J5Lm1hcCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2V0RGF0ZSA9IGZ1bmN0aW9uICh1bml4KSB7XG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUodW5peCAqIDEwMDApO1xuICAgICAgICB2YXIgaG91cnMgPSBkYXRlLmdldEhvdXJzKCk7XG4gICAgICAgIHZhciBhbXBtID0gKGRhdGUuZ2V0SG91cnMoKSA+IDEyKSA/ICdQTScgOiAnQU0nO1xuICAgICAgICBob3VycyA9IGhvdXJzICUgMTI7XG4gICAgICAgIGhvdXJzID0gKGhvdXJzKSA/IGhvdXJzIDogMTI7XG4gICAgICAgIHZhciBtaW51dGVzID0gZGF0ZS5nZXRNaW51dGVzKCk7XG4gICAgICAgIG1pbnV0ZXMgPSAobWludXRlcyA8IDEwKSA/ICcwJyArIG1pbnV0ZXMgOiBtaW51dGVzO1xuICAgICAgICByZXR1cm4gJ1RvZGF5IEAgJyArIGhvdXJzICsgJzonICsgbWludXRlcyArICcgJyArIGFtcG07XG4gICAgfTtcblxuICAgICRzY29wZS5kcmF3TG9jYXRpb24gPSBmdW5jdGlvbiAobG9jYXRpb24sIG9wdHMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRzICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgb3B0cyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIG9wdHMuaWNvbiA9ICcvaW1hZ2VzL2Jpa2UucG5nJztcbiAgICAgICAgb3B0cy5wb3NpdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobG9jYXRpb25bMF0sIGxvY2F0aW9uWzFdKTtcbiAgICAgICAgb3B0cy5tYXAgPSBtYXA7XG4gICAgICAgIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKG9wdHMpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2V0TWFwQ2VudGVyID0gZnVuY3Rpb24gKGxvY2F0aW9uT2JqKSB7XG4gICAgICAgIHZhciBjZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxvY2F0aW9uT2JqWzBdLmxhdCwgbG9jYXRpb25PYmpbMV0ubG5nKTtcbiAgICAgICAgTWFwRmFjdG9yeS5tYXAuc2V0Q2VudGVyKGNlbnRlcik7XG4gICAgfTtcblxuICAgICRzY29wZS5pbml0TWFwKCk7XG59KTtcbiIsImFwcC5mYWN0b3J5KCdNYXBGYWN0b3J5JywgZnVuY3Rpb24oJGh0dHApe1xuXHRyZXR1cm4ge1xuXHRcdHN0YXRpb25zOiBbXSxcblx0XHR1cGRhdGVzOiB7fSxcblx0XHRvcmlnaW46IG51bGwsXG5cdFx0ZGVzdGluYXRpb246IG51bGwsXG5cdFx0bWFwOiBudWxsLFxuXHRcdHVzZXJIb21lOiBudWxsLFxuXHRcdG1hcmtlcnM6IFtdLFxuXHRcdGdldFN0YXRpb25zOiBmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuICRodHRwLmdldCgnL2FwaS9zdGF0aW9ucycpXG5cdFx0XHQudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHRcdHJldHVybiByZXNwb25zZTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0Z2V0VXBkYXRlczogZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXBkYXRlJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRzZXRDZW50ZXI6IGZ1bmN0aW9uIChsb2NhdGlvbk9iaikge1xuXHRcdCAgICB2YXIgY2VudGVyID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvbk9ialswXS5sYXQsIGxvY2F0aW9uT2JqWzFdLmxuZyk7XG5cdFx0ICAgIHRoaXMubWFwLnNldENlbnRlcihjZW50ZXIpO1xuXHRcdH1cblx0fTtcbn0pOyIsImFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAuc3RhdGUoJ21hcCcsIHtcbiAgICAgICAgICAgIHVybDogJycsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCIvYXBwL21hcC9tYXAuaHRtbFwiLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ01hcENvbnRyb2xsZXInLFxuICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgIHN0YXRpb25zOiBmdW5jdGlvbiAoTWFwRmFjdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWFwRmFjdG9yeS5nZXRTdGF0aW9ucygpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdXBkYXRlczogZnVuY3Rpb24gKE1hcEZhY3RvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hcEZhY3RvcnkuZ2V0VXBkYXRlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgLnN0YXRlKCdtYXAucGFuZWwnLCB7XG4gICAgICAgICAgICB1cmw6ICcvcGFuZWwnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3BhbmVsL3BhbmVsLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1BhbmVsQ29udHJvbGxlcidcbiAgICAgICAgfSk7XG4gICAgJHVybFJvdXRlclByb3ZpZGVyLndoZW4oJy9hcGkvYXV0aC9nb29nbGUnLCAnLycpO1xufSk7XG4iLCJhcHAuZGlyZWN0aXZlKCdmb290ZXInLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiBcIkVcIixcblx0XHR0ZW1wbGF0ZVVybDogXCIvZm9vdGVyLmh0bWxcIlxuXHR9O1xufSk7IiwiYXBwLmRpcmVjdGl2ZSgnbW9kYWwnLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6ICcvbW9kYWwuaHRtbCdcblx0fTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdOYXZiYXJDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgQXV0aEZhY3Rvcnkpe1xuXHQkc2NvcGUuc2hvd0xvZ2luID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIG1vZGFsID0gYW5ndWxhci5lbGVtZW50KCcjbG9naW5Nb2RhbCcpO1xuXHRcdGlmIChtb2RhbC5oYXNDbGFzcygnc2hvdycpKSB7XG5cdFx0XHRtb2RhbC5yZW1vdmVDbGFzcygnc2hvdycpO1xuXHRcdFx0bW9kYWwuYWRkQ2xhc3MoJ2hpZGUnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bW9kYWwucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcblx0XHRcdG1vZGFsLmFkZENsYXNzKCdzaG93Jyk7XG5cdFx0fVxuXHR9O1xuXG5cdCRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0QXV0aEZhY3RvcnkubG9nb3V0KCk7XG5cdH07XG5cblx0JHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpe1xuXHRcdGFuZ3VsYXIuZWxlbWVudCgnI2xvZ2luTW9kYWwnKS5hZGRDbGFzcygnaGlkZScpO1xuXHRcdGFuZ3VsYXIuZWxlbWVudCgnI2xvZ2luTW9kYWwnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuXHR9O1xufSk7IiwiYXBwLmRpcmVjdGl2ZSgnbmF2YmFyJywgZnVuY3Rpb24oKXtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogJ0UnLFxuXHRcdHRlbXBsYXRlVXJsOiBcIi9uYXZiYXIuaHRtbFwiLFxuXHRcdGNvbnRyb2xsZXI6ICdOYXZiYXJDb250cm9sbGVyJ1xuXHR9O1xufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
