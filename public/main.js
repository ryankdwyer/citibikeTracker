'use strict';

var app = angular.module('citi', ['ui.router']);

app.controller('AuthController', function ($scope, AuthFactory, MapFactory) {
    var home = document.getElementById('pac-input-home');
    var homeBox = new google.maps.places.Autocomplete(home);
    var location;

    homeBox.addListener('place_changed', function () {
        location = parseLocation(homeBox.getPlace());
    });

    function parseLocation(placesObj) {
        return [{ lat: placesObj.geometry.location.G }, { lng: placesObj.geometry.location.K }];
    }

    $scope.signUp = function (credentials) {
        if (location) {
            credentials.home = location;
            AuthFactory.register(credentials).then(function () {
                $scope.closeModal();
            });
        } else {
            alert("Please enter a valid address");
        }
    };

    $scope.signInWithGoogle = function () {
        AuthFactory.signInWithGoogle().then(function (user) {
            $scope.closeModal();
            MapFactory.userHome = user.home;
            MapFactory.setCenter(MapFactory.userHome);
            alert('Welcome ' + user.name + '!');
        });
    };

    $scope.loginSubmit = function (credentials) {
        console.log($scope.loginForm);
        AuthFactory.login(credentials).then(function (user) {
            $scope.closeModal();
            MapFactory.userHome = user.home;
            console.log('user home', MapFactory.userHome);
            MapFactory.setCenter(MapFactory.userHome);
            alert('Welcome ' + user.name + '!');
        });
    };

    $scope.logOut = function () {
        AuthFactory.logOut();
    };

    $scope.showLogin = function () {
        var modal = angular.element('#loginModal');
        modal.removeClass('hide');
        modal.addClass('show');
    };

    $scope.showSignup = function () {
        var modal = angular.element('#signupModal');
        modal.removeClass('hide');
        modal.addClass('show');
    };

    $scope.closeModal = function () {
        angular.element('#loginModal').addClass('hide');
        angular.element('#loginModal').removeClass('show');
        angular.element('#signupModal').addClass('hide');
        angular.element('#signupModal').removeClass('show');
    };
});

app.factory('AuthFactory', function ($http, $state) {
    function toData(response) {
        return response.data;
    }
    return {
        login: function login(credentials) {
            return $http.post('/api/login', credentials).then(toData);
        },
        register: function register(credentials) {
            return $http.post('api/register', credentials).then(toData);
        },
        logout: function logout() {
            return $http.post('api/logout').then(toData);
        },
        signInWithGoogle: function signInWithGoogle() {
            return $http.get('api/auth/google').then(function (response) {
                return response.data;
            });
        }
    };
});

app.directive('login', function () {
    return {
        restrict: 'E',
        templateUrl: '/app/auth/auth.html',
        controller: 'AuthController'
    };
});

app.controller('MapController', function ($scope, MapFactory, stations, updates) {
    var map;
    $scope.initMap = function () {
        var home = {
            lat: 40.729546,
            lng: -73.98569
        };

        map = new google.maps.Map(angular.element('#map-canvas')[0], {
            center: home,
            zoom: 13
        });
        MapFactory.map = map;

        var bikeLayer = new google.maps.BicyclingLayer();
        bikeLayer.setMap(map);

        var bounds = new google.maps.LatLngBounds();

        var infowindow = new google.maps.InfoWindow();
        map.addListener('click', function () {
            infowindow.close();
        });

        stations.data.forEach(function (el) {
            var marker = $scope.drawLocation([el.latitude, el.longitude], {});
            MapFactory.markers.push(marker);
            marker.addListener('click', function () {
                infowindow.close();
                var contentString;
                contentString = "<p>Station: " + el.label + "</p>" + "<p>Bikes: " + updates.data[el.stationId][0] + '</p>' + "<p>Docks: " + updates.data[el.stationId][1] + '</p>' + "<p>Active: " + el.status + '</p>' + "<p>Last Update: " + $scope.setDate(updates.data[el.stationId][2]) + '</p>';
                infowindow.setContent(contentString);
                infowindow.open(map, marker);
            });
        });
    };

    $scope.updater = function () {
        MapFactory.getUpdates().then(function (response) {
            updates = response;
            $scope.initMap();
        });
    };

    $scope.removeMarkers = function () {
        MapFactory.markers.forEach(function (el) {
            el.setMap(null);
        });
    };

    $scope.showMarkers = function () {
        MapFactory.markers.forEach(function (el) {
            el.setMap(MapFactory.map);
        });
    };

    $scope.setDate = function (unix) {
        var date = new Date(unix * 1000);
        var hours = date.getHours();
        var ampm = date.getHours() > 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        var minutes = date.getMinutes();
        minutes = minutes < 10 ? '0' + minutes : minutes;
        return 'Today @ ' + hours + ':' + minutes + ' ' + ampm;
    };

    $scope.drawLocation = function (location, opts) {
        if (typeof opts !== 'object') {
            opts = {};
        }
        opts.icon = '/images/bike.png';
        opts.position = new google.maps.LatLng(location[0], location[1]);
        opts.map = map;
        return new google.maps.Marker(opts);
    };

    $scope.setMapCenter = function (locationObj) {
        var center = new google.maps.LatLng(locationObj[0].lat, locationObj[1].lng);
        MapFactory.map.setCenter(center);
    };

    $scope.initMap();
});

app.factory('MapFactory', function ($http) {
    return {
        stations: [],
        updates: {},
        origin: null,
        destination: null,
        map: null,
        userHome: null,
        markers: [],
        getStations: function getStations() {
            return $http.get('/api/stations').then(function (response) {
                return response;
            });
        },
        getUpdates: function getUpdates() {
            return $http.get('/api/update').then(function (response) {
                return response;
            });
        },
        setCenter: function setCenter(locationObj) {
            var center = new google.maps.LatLng(locationObj[0].lat, locationObj[1].lng);
            this.map.setCenter(center);
        }
    };
});
app.config(function ($stateProvider, $urlRouterProvider) {
    $stateProvider.state('map', {
        url: '',
        templateUrl: "/app/map/map.html",
        controller: 'MapController',
        resolve: {
            stations: function stations(MapFactory) {
                return MapFactory.getStations();
            },
            updates: function updates(MapFactory) {
                return MapFactory.getUpdates();
            }
        }
    });
    $stateProvider.state('map.panel', {
        url: '/panel',
        templateUrl: '/app/panel/panel.html',
        controller: 'PanelController'
    });
    $urlRouterProvider.when('/api/auth/google', '/');
});

app.directive('footer', function () {
    return {
        restrict: "E",
        templateUrl: "/footer.html"
    };
});
app.controller('PanelController', function ($scope, MapFactory) {
    var origin = document.getElementById('pac-input-origin');
    var originBox = new google.maps.places.Autocomplete(origin);
    var destination = document.getElementById('pac-input-destination');
    var destinationBox = new google.maps.places.Autocomplete(destination);

    originBox.addListener('place_changed', function () {
        MapFactory.origin = originBox.getPlace();
    });

    destinationBox.addListener('place_changed', function () {
        MapFactory.destination = destinationBox.getPlace();
    });

    function newLatLngObj(locationObj) {
        var newLoc = new google.maps.LatLng(locationObj.geometry.location.lat(), locationObj.geometry.location.lng());
        return newLoc;
    }

    $scope.setBounds = function () {
        var bounds = new google.maps.LatLngBounds();
        origin = newLatLngObj(MapFactory.origin);
        destination = newLatLngObj(MapFactory.destination);
        bounds.extend(origin);
        bounds.extend(destination);
        MapFactory.map.fitBounds(bounds);
    };

    $scope.getTravelTime = function () {
        var service = new google.maps.DistanceMatrixService();
        var infowindow = new google.maps.InfoWindow();
        service.getDistanceMatrix({
            origins: [newLatLngObj(MapFactory.origin)],
            destinations: [newLatLngObj(MapFactory.destination)],
            travelMode: google.maps.TravelMode.BICYCLING
        }, function (response, status) {
            if (status === google.maps.DistanceMatrixStatus.OK) {
                infowindow.setContent(response.rows[0].elements[0].duration.text);
            }
        });
    };

    $scope.calcAndDisplayRoute = function () {
        var directionsService = new google.maps.DirectionsService();
        $scope.getTravelTime();
        directionsService.route({
            origin: newLatLngObj(MapFactory.origin),
            destination: newLatLngObj(MapFactory.destination),
            travelMode: google.maps.TravelMode.BICYCLING,
            provideRouteAlternatives: true
        }, function (response, status) {
            if (status === google.maps.DirectionsStatus.OK) {
                for (var i = 0; i < response.routes.length; i++) {
                    var color = i === 0 ? 'DodgerBlue' : 'DarkGray';
                    var zIndex = i === 0 ? 1000 : null;
                    var directions = new google.maps.DirectionsRenderer({
                        map: MapFactory.map,
                        directions: response,
                        routeIndex: i,
                        polylineOptions: {
                            strokeColor: color,
                            zIndex: zIndex,
                            strokeWeight: 5
                        }
                    });
                    if (i === 0) directions.setPanel(document.getElementById('directionsPanel'));
                }
            } else {
                // window.alert('Directions request failed due to: ', status);
                console.log('failed', response.status);
            }
        });
    };
});

app.directive('modal', function () {
    return {
        restrict: 'E',
        templateUrl: '/modal.html'
    };
});
app.controller('NavbarController', function ($scope, $http, AuthFactory) {
    $scope.showLogin = function () {
        var modal = angular.element('#loginModal');
        if (modal.hasClass('show')) {
            modal.removeClass('show');
            modal.addClass('hide');
        } else {
            modal.removeClass('hide');
            modal.addClass('show');
        }
    };

    $scope.logout = function () {
        AuthFactory.logout();
    };

    $scope.closeModal = function () {
        angular.element('#loginModal').addClass('hide');
        angular.element('#loginModal').removeClass('show');
    };
});
app.directive('navbar', function () {
    return {
        restrict: 'E',
        templateUrl: "/navbar.html",
        controller: 'NavbarController'
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC9hdXRoL2F1dGguY29udHJvbGxlci5qcyIsImFwcC9hdXRoL2F1dGguZmFjdG9yeS5qcyIsImFwcC9hdXRoL2F1dGguanMiLCJhcHAvbWFwL21hcC5jb250cm9sbGVyLmpzIiwiYXBwL21hcC9tYXAuZmFjdG9yeS5qcyIsImFwcC9tYXAvbWFwLnN0YXRlLmpzIiwiY29tcG9uZW50cy9mb290ZXIvZm9vdGVyLmpzIiwiYXBwL3BhbmVsL3BhbmVsLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL21vZGFsL21vZGFsLmpzIiwiY29tcG9uZW50cy9uYXZiYXIvbmF2YmFyLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL25hdmJhci9uYXZiYXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBLEdBQUEsR0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLE1BQUEsRUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUE7O0FDQUEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxnQkFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFdBQUEsRUFBQSxVQUFBLEVBQUE7QUFDQSxRQUFBLElBQUEsR0FBQSxRQUFBLENBQUEsY0FBQSxDQUFBLGdCQUFBLENBQUEsQ0FBQTtBQUNBLFFBQUEsT0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsWUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsUUFBQSxRQUFBLENBQUE7O0FBRUEsV0FBQSxDQUFBLFdBQUEsQ0FBQSxlQUFBLEVBQUEsWUFBQTtBQUNBLGdCQUFBLEdBQUEsYUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLEVBQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQSxDQUFBOztBQUVBLGFBQUEsYUFBQSxDQUFBLFNBQUEsRUFBQTtBQUNBLGVBQUEsQ0FDQSxFQUFBLEdBQUEsRUFBQSxTQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEVBQUEsRUFDQSxFQUFBLEdBQUEsRUFBQSxTQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FDQSxDQUFBO0tBQ0E7O0FBRUEsVUFBQSxDQUFBLE1BQUEsR0FBQSxVQUFBLFdBQUEsRUFBQTtBQUNBLFlBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsQ0FBQSxJQUFBLEdBQUEsUUFBQSxDQUFBO0FBQ0EsdUJBQUEsQ0FBQSxRQUFBLENBQUEsV0FBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFlBQUE7QUFDQSxzQkFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO2FBQ0EsQ0FBQSxDQUFBO1NBQ0EsTUFBQTtBQUNBLGlCQUFBLENBQUEsOEJBQUEsQ0FBQSxDQUFBO1NBQ0E7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxnQkFBQSxHQUFBLFlBQUE7QUFDQSxtQkFBQSxDQUFBLGdCQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxrQkFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxRQUFBLEdBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLHNCQUFBLENBQUEsU0FBQSxDQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsVUFBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxXQUFBLEdBQUEsVUFBQSxXQUFBLEVBQUE7QUFDQSxlQUFBLENBQUEsR0FBQSxDQUFBLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQTtBQUNBLG1CQUFBLENBQUEsS0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLElBQUEsRUFBQTtBQUNBLGtCQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxzQkFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLENBQUEsSUFBQSxDQUFBO0FBQ0EsbUJBQUEsQ0FBQSxHQUFBLENBQUEsV0FBQSxFQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLHNCQUFBLENBQUEsU0FBQSxDQUFBLFVBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsVUFBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxNQUFBLEdBQUEsWUFBQTtBQUNBLG1CQUFBLENBQUEsTUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxTQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsS0FBQSxHQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7QUFDQSxhQUFBLENBQUEsV0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsYUFBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLFVBQUEsR0FBQSxZQUFBO0FBQ0EsWUFBQSxLQUFBLEdBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQTtBQUNBLGFBQUEsQ0FBQSxXQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxhQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsVUFBQSxHQUFBLFlBQUE7QUFDQSxlQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLGVBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUEsV0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsZUFBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxlQUFBLENBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBLFdBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDeEVBLEdBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxFQUFBLFVBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQTtBQUNBLGFBQUEsTUFBQSxDQUFBLFFBQUEsRUFBQTtBQUNBLGVBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQTtLQUNBO0FBQ0EsV0FBQTtBQUNBLGFBQUEsRUFBQSxlQUFBLFdBQUEsRUFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsWUFBQSxFQUFBLFdBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtTQUNBO0FBQ0EsZ0JBQUEsRUFBQSxrQkFBQSxXQUFBLEVBQUE7QUFDQSxtQkFBQSxLQUFBLENBQUEsSUFBQSxDQUFBLGNBQUEsRUFBQSxXQUFBLENBQUEsQ0FDQSxJQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7U0FDQTtBQUNBLGNBQUEsRUFBQSxrQkFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsWUFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1NBQ0E7QUFDQSx3QkFBQSxFQUFBLDRCQUFBO0FBQ0EsbUJBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxpQkFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBO0tBQ0EsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUN4QkEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxPQUFBLEVBQUEsWUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEdBQUE7QUFDQSxtQkFBQSxFQUFBLHFCQUFBO0FBQ0Esa0JBQUEsRUFBQSxnQkFBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7O0FDTkEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxlQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsVUFBQSxFQUFBLFFBQUEsRUFBQSxPQUFBLEVBQUE7QUFDQSxRQUFBLEdBQUEsQ0FBQTtBQUNBLFVBQUEsQ0FBQSxPQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsSUFBQSxHQUFBO0FBQ0EsZUFBQSxFQUFBLFNBQUE7QUFDQSxlQUFBLEVBQUEsQ0FBQSxRQUFBO1NBQ0EsQ0FBQTs7QUFFQSxXQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxFQUFBO0FBQ0Esa0JBQUEsRUFBQSxJQUFBO0FBQ0EsZ0JBQUEsRUFBQSxFQUFBO1NBQ0EsQ0FBQSxDQUFBO0FBQ0Esa0JBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBOztBQUVBLFlBQUEsU0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxjQUFBLEVBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsTUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBOztBQUVBLFlBQUEsTUFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQTs7QUFFQSxZQUFBLFVBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxXQUFBLENBQUEsV0FBQSxDQUFBLE9BQUEsRUFBQSxZQUFBO0FBQ0Esc0JBQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQTtTQUNBLENBQUEsQ0FBQTs7QUFFQSxnQkFBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxFQUFBLEVBQUE7QUFDQSxnQkFBQSxNQUFBLEdBQUEsTUFBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxRQUFBLEVBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0Esa0JBQUEsQ0FBQSxXQUFBLENBQUEsT0FBQSxFQUFBLFlBQUE7QUFDQSwwQkFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO0FBQ0Esb0JBQUEsYUFBQSxDQUFBO0FBQ0EsNkJBQUEsR0FBQSxjQUFBLEdBQUEsRUFBQSxDQUFBLEtBQUEsR0FBQSxNQUFBLEdBQ0EsWUFBQSxHQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLE1BQUEsR0FDQSxZQUFBLEdBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsTUFBQSxHQUNBLGFBQUEsR0FBQSxFQUFBLENBQUEsTUFBQSxHQUFBLE1BQUEsR0FDQSxrQkFBQSxHQUFBLE1BQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQSxNQUFBLENBQUE7QUFDQSwwQkFBQSxDQUFBLFVBQUEsQ0FBQSxhQUFBLENBQUEsQ0FBQTtBQUNBLDBCQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLE9BQUEsR0FBQSxZQUFBO0FBQ0Esa0JBQUEsQ0FBQSxVQUFBLEVBQUEsQ0FDQSxJQUFBLENBQUEsVUFBQSxRQUFBLEVBQUE7QUFDQSxtQkFBQSxHQUFBLFFBQUEsQ0FBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxFQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxhQUFBLEdBQUEsWUFBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLENBQUE7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxXQUFBLEdBQUEsWUFBQTtBQUNBLGtCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsVUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO1NBQ0EsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsT0FBQSxHQUFBLFVBQUEsSUFBQSxFQUFBO0FBQ0EsWUFBQSxJQUFBLEdBQUEsSUFBQSxJQUFBLENBQUEsSUFBQSxHQUFBLElBQUEsQ0FBQSxDQUFBO0FBQ0EsWUFBQSxLQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxDQUFBO0FBQ0EsWUFBQSxJQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxJQUFBLEdBQUEsSUFBQSxDQUFBO0FBQ0EsYUFBQSxHQUFBLEtBQUEsR0FBQSxFQUFBLENBQUE7QUFDQSxhQUFBLEdBQUEsS0FBQSxHQUFBLEtBQUEsR0FBQSxFQUFBLENBQUE7QUFDQSxZQUFBLE9BQUEsR0FBQSxJQUFBLENBQUEsVUFBQSxFQUFBLENBQUE7QUFDQSxlQUFBLEdBQUEsT0FBQSxHQUFBLEVBQUEsR0FBQSxHQUFBLEdBQUEsT0FBQSxHQUFBLE9BQUEsQ0FBQTtBQUNBLGVBQUEsVUFBQSxHQUFBLEtBQUEsR0FBQSxHQUFBLEdBQUEsT0FBQSxHQUFBLEdBQUEsR0FBQSxJQUFBLENBQUE7S0FDQSxDQUFBOztBQUVBLFVBQUEsQ0FBQSxZQUFBLEdBQUEsVUFBQSxRQUFBLEVBQUEsSUFBQSxFQUFBO0FBQ0EsWUFBQSxPQUFBLElBQUEsS0FBQSxRQUFBLEVBQUE7QUFDQSxnQkFBQSxHQUFBLEVBQUEsQ0FBQTtTQUNBO0FBQ0EsWUFBQSxDQUFBLElBQUEsR0FBQSxrQkFBQSxDQUFBO0FBQ0EsWUFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQTtBQUNBLFlBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBO0FBQ0EsZUFBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsWUFBQSxHQUFBLFVBQUEsV0FBQSxFQUFBO0FBQ0EsWUFBQSxNQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQSxFQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtBQUNBLGtCQUFBLENBQUEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLE9BQUEsRUFBQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQ3hGQSxHQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsRUFBQSxVQUFBLEtBQUEsRUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEVBQUE7QUFDQSxlQUFBLEVBQUEsRUFBQTtBQUNBLGNBQUEsRUFBQSxJQUFBO0FBQ0EsbUJBQUEsRUFBQSxJQUFBO0FBQ0EsV0FBQSxFQUFBLElBQUE7QUFDQSxnQkFBQSxFQUFBLElBQUE7QUFDQSxlQUFBLEVBQUEsRUFBQTtBQUNBLG1CQUFBLEVBQUEsdUJBQUE7QUFDQSxtQkFBQSxLQUFBLENBQUEsR0FBQSxDQUFBLGVBQUEsQ0FBQSxDQUNBLElBQUEsQ0FBQSxVQUFBLFFBQUEsRUFBQTtBQUNBLHVCQUFBLFFBQUEsQ0FBQTthQUNBLENBQUEsQ0FBQTtTQUNBO0FBQ0Esa0JBQUEsRUFBQSxzQkFBQTtBQUNBLG1CQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsYUFBQSxDQUFBLENBQ0EsSUFBQSxDQUFBLFVBQUEsUUFBQSxFQUFBO0FBQ0EsdUJBQUEsUUFBQSxDQUFBO2FBQ0EsQ0FBQSxDQUFBO1NBQ0E7QUFDQSxpQkFBQSxFQUFBLG1CQUFBLFdBQUEsRUFBQTtBQUNBLGdCQUFBLE1BQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLEVBQUEsV0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO0FBQ0EsZ0JBQUEsQ0FBQSxHQUFBLENBQUEsU0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1NBQ0E7S0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBO0FDMUJBLEdBQUEsQ0FBQSxNQUFBLENBQUEsVUFBQSxjQUFBLEVBQUEsa0JBQUEsRUFBQTtBQUNBLGtCQUFBLENBQ0EsS0FBQSxDQUFBLEtBQUEsRUFBQTtBQUNBLFdBQUEsRUFBQSxFQUFBO0FBQ0EsbUJBQUEsRUFBQSxtQkFBQTtBQUNBLGtCQUFBLEVBQUEsZUFBQTtBQUNBLGVBQUEsRUFBQTtBQUNBLG9CQUFBLEVBQUEsa0JBQUEsVUFBQSxFQUFBO0FBQ0EsdUJBQUEsVUFBQSxDQUFBLFdBQUEsRUFBQSxDQUFBO2FBQ0E7QUFDQSxtQkFBQSxFQUFBLGlCQUFBLFVBQUEsRUFBQTtBQUNBLHVCQUFBLFVBQUEsQ0FBQSxVQUFBLEVBQUEsQ0FBQTthQUNBO1NBQ0E7S0FDQSxDQUFBLENBQUE7QUFDQSxrQkFBQSxDQUNBLEtBQUEsQ0FBQSxXQUFBLEVBQUE7QUFDQSxXQUFBLEVBQUEsUUFBQTtBQUNBLG1CQUFBLEVBQUEsdUJBQUE7QUFDQSxrQkFBQSxFQUFBLGlCQUFBO0tBQ0EsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsQ0FBQSxJQUFBLENBQUEsa0JBQUEsRUFBQSxHQUFBLENBQUEsQ0FBQTtDQUNBLENBQUEsQ0FBQTs7QUN0QkEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxRQUFBLEVBQUEsWUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEdBQUE7QUFDQSxtQkFBQSxFQUFBLGNBQUE7S0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBO0FDTEEsR0FBQSxDQUFBLFVBQUEsQ0FBQSxpQkFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLFVBQUEsRUFBQTtBQUNBLFFBQUEsTUFBQSxHQUFBLFFBQUEsQ0FBQSxjQUFBLENBQUEsa0JBQUEsQ0FBQSxDQUFBO0FBQ0EsUUFBQSxTQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxZQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxRQUFBLFdBQUEsR0FBQSxRQUFBLENBQUEsY0FBQSxDQUFBLHVCQUFBLENBQUEsQ0FBQTtBQUNBLFFBQUEsY0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsWUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUVBLGFBQUEsQ0FBQSxXQUFBLENBQUEsZUFBQSxFQUFBLFlBQUE7QUFDQSxrQkFBQSxDQUFBLE1BQUEsR0FBQSxTQUFBLENBQUEsUUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBLENBQUE7O0FBRUEsa0JBQUEsQ0FBQSxXQUFBLENBQUEsZUFBQSxFQUFBLFlBQUE7QUFDQSxrQkFBQSxDQUFBLFdBQUEsR0FBQSxjQUFBLENBQUEsUUFBQSxFQUFBLENBQUE7S0FDQSxDQUFBLENBQUE7O0FBRUEsYUFBQSxZQUFBLENBQUEsV0FBQSxFQUFBO0FBQ0EsWUFBQSxNQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FDQSxXQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxHQUFBLEVBQUEsRUFDQSxXQUFBLENBQUEsUUFBQSxDQUFBLFFBQUEsQ0FBQSxHQUFBLEVBQUEsQ0FDQSxDQUFBO0FBQ0EsZUFBQSxNQUFBLENBQUE7S0FDQTs7QUFFQSxVQUFBLENBQUEsU0FBQSxHQUFBLFlBQUE7QUFDQSxZQUFBLE1BQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsWUFBQSxFQUFBLENBQUE7QUFDQSxjQUFBLEdBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLG1CQUFBLEdBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQTtBQUNBLGNBQUEsQ0FBQSxNQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxjQUFBLENBQUEsTUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBO0FBQ0Esa0JBQUEsQ0FBQSxHQUFBLENBQUEsU0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsYUFBQSxHQUFBLFlBQUE7QUFDQSxZQUFBLE9BQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEscUJBQUEsRUFBQSxDQUFBO0FBQ0EsWUFBQSxVQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO0FBQ0EsZUFBQSxDQUFBLGlCQUFBLENBQUE7QUFDQSxtQkFBQSxFQUFBLENBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLHdCQUFBLEVBQUEsQ0FBQSxZQUFBLENBQUEsVUFBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBO0FBQ0Esc0JBQUEsRUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsQ0FBQSxTQUFBO1NBQ0EsRUFBQSxVQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUE7QUFDQSxnQkFBQSxNQUFBLEtBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxvQkFBQSxDQUFBLEVBQUEsRUFBQTtBQUNBLDBCQUFBLENBQUEsVUFBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTthQUNBO1NBQ0EsQ0FBQSxDQUFBO0tBQ0EsQ0FBQTs7QUFFQSxVQUFBLENBQUEsbUJBQUEsR0FBQSxZQUFBO0FBQ0EsWUFBQSxpQkFBQSxHQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxpQkFBQSxFQUFBLENBQUE7QUFDQSxjQUFBLENBQUEsYUFBQSxFQUFBLENBQUE7QUFDQSx5QkFBQSxDQUFBLEtBQUEsQ0FBQTtBQUNBLGtCQUFBLEVBQUEsWUFBQSxDQUFBLFVBQUEsQ0FBQSxNQUFBLENBQUE7QUFDQSx1QkFBQSxFQUFBLFlBQUEsQ0FBQSxVQUFBLENBQUEsV0FBQSxDQUFBO0FBQ0Esc0JBQUEsRUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsQ0FBQSxTQUFBO0FBQ0Esb0NBQUEsRUFBQSxJQUFBO1NBQ0EsRUFBQSxVQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUE7QUFDQSxnQkFBQSxNQUFBLEtBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxnQkFBQSxDQUFBLEVBQUEsRUFBQTtBQUNBLHFCQUFBLElBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxDQUFBLEdBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUE7QUFDQSx3QkFBQSxLQUFBLEdBQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxZQUFBLEdBQUEsVUFBQSxDQUFBO0FBQ0Esd0JBQUEsTUFBQSxHQUFBLENBQUEsS0FBQSxDQUFBLEdBQUEsSUFBQSxHQUFBLElBQUEsQ0FBQTtBQUNBLHdCQUFBLFVBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsa0JBQUEsQ0FBQTtBQUNBLDJCQUFBLEVBQUEsVUFBQSxDQUFBLEdBQUE7QUFDQSxrQ0FBQSxFQUFBLFFBQUE7QUFDQSxrQ0FBQSxFQUFBLENBQUE7QUFDQSx1Q0FBQSxFQUFBO0FBQ0EsdUNBQUEsRUFBQSxLQUFBO0FBQ0Esa0NBQUEsRUFBQSxNQUFBO0FBQ0Esd0NBQUEsRUFBQSxDQUFBO3lCQUNBO3FCQUNBLENBQUEsQ0FBQTtBQUNBLHdCQUFBLENBQUEsS0FBQSxDQUFBLEVBQUEsVUFBQSxDQUFBLFFBQUEsQ0FBQSxRQUFBLENBQUEsY0FBQSxDQUFBLGlCQUFBLENBQUEsQ0FBQSxDQUFBO2lCQUNBO2FBQ0EsTUFBQTs7QUFFQSx1QkFBQSxDQUFBLEdBQUEsQ0FBQSxRQUFBLEVBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO2FBQ0E7U0FDQSxDQUFBLENBQUE7S0FDQSxDQUFBO0NBQ0EsQ0FBQSxDQUFBOztBQzVFQSxHQUFBLENBQUEsU0FBQSxDQUFBLE9BQUEsRUFBQSxZQUFBO0FBQ0EsV0FBQTtBQUNBLGdCQUFBLEVBQUEsR0FBQTtBQUNBLG1CQUFBLEVBQUEsYUFBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7QUNMQSxHQUFBLENBQUEsVUFBQSxDQUFBLGtCQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQTtBQUNBLFVBQUEsQ0FBQSxTQUFBLEdBQUEsWUFBQTtBQUNBLFlBQUEsS0FBQSxHQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7QUFDQSxZQUFBLEtBQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLEVBQUE7QUFDQSxpQkFBQSxDQUFBLFdBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtBQUNBLGlCQUFBLENBQUEsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1NBQ0EsTUFBQTtBQUNBLGlCQUFBLENBQUEsV0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0FBQ0EsaUJBQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7U0FDQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLE1BQUEsR0FBQSxZQUFBO0FBQ0EsbUJBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQTtLQUNBLENBQUE7O0FBRUEsVUFBQSxDQUFBLFVBQUEsR0FBQSxZQUFBO0FBQ0EsZUFBQSxDQUFBLE9BQUEsQ0FBQSxhQUFBLENBQUEsQ0FBQSxRQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7QUFDQSxlQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBLFdBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtLQUNBLENBQUE7Q0FDQSxDQUFBLENBQUE7QUNwQkEsR0FBQSxDQUFBLFNBQUEsQ0FBQSxRQUFBLEVBQUEsWUFBQTtBQUNBLFdBQUE7QUFDQSxnQkFBQSxFQUFBLEdBQUE7QUFDQSxtQkFBQSxFQUFBLGNBQUE7QUFDQSxrQkFBQSxFQUFBLGtCQUFBO0tBQ0EsQ0FBQTtDQUNBLENBQUEsQ0FBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjaXRpJywgWyd1aS5yb3V0ZXInXSk7XG4iLCJhcHAuY29udHJvbGxlcignQXV0aENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBBdXRoRmFjdG9yeSwgTWFwRmFjdG9yeSkge1xuICAgIHZhciBob21lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhYy1pbnB1dC1ob21lJyk7XG4gICAgdmFyIGhvbWVCb3ggPSBuZXcgZ29vZ2xlLm1hcHMucGxhY2VzLkF1dG9jb21wbGV0ZShob21lKTtcbiAgICB2YXIgbG9jYXRpb247XG5cbiAgICBob21lQm94LmFkZExpc3RlbmVyKCdwbGFjZV9jaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBsb2NhdGlvbiA9IHBhcnNlTG9jYXRpb24oaG9tZUJveC5nZXRQbGFjZSgpKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHBhcnNlTG9jYXRpb24ocGxhY2VzT2JqKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICB7bGF0OiBwbGFjZXNPYmouZ2VvbWV0cnkubG9jYXRpb24uR30sXG4gICAgICAgICAgICB7bG5nOiBwbGFjZXNPYmouZ2VvbWV0cnkubG9jYXRpb24uS31cbiAgICAgICAgICAgIF07XG4gICAgfVxuXG4gICAgJHNjb3BlLnNpZ25VcCA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xuICAgICAgICBpZiAobG9jYXRpb24pIHtcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzLmhvbWUgPSBsb2NhdGlvbjtcbiAgICAgICAgICAgIEF1dGhGYWN0b3J5LnJlZ2lzdGVyKGNyZWRlbnRpYWxzKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhbGVydChcIlBsZWFzZSBlbnRlciBhIHZhbGlkIGFkZHJlc3NcIik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLnNpZ25JbldpdGhHb29nbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEF1dGhGYWN0b3J5LnNpZ25JbldpdGhHb29nbGUoKVxuICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKXtcbiAgICAgICAgICAgICRzY29wZS5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICBNYXBGYWN0b3J5LnVzZXJIb21lID0gdXNlci5ob21lO1xuICAgICAgICAgICAgTWFwRmFjdG9yeS5zZXRDZW50ZXIoTWFwRmFjdG9yeS51c2VySG9tZSk7XG4gICAgICAgICAgICBhbGVydCgnV2VsY29tZSAnICsgdXNlci5uYW1lICsgJyEnKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5sb2dpblN1Ym1pdCA9IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUubG9naW5Gb3JtKTtcbiAgICAgICAgQXV0aEZhY3RvcnkubG9naW4oY3JlZGVudGlhbHMpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpe1xuICAgICAgICAgICAgJHNjb3BlLmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgIE1hcEZhY3RvcnkudXNlckhvbWUgPSB1c2VyLmhvbWU7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygndXNlciBob21lJywgTWFwRmFjdG9yeS51c2VySG9tZSk7XG4gICAgICAgICAgICBNYXBGYWN0b3J5LnNldENlbnRlcihNYXBGYWN0b3J5LnVzZXJIb21lKTtcbiAgICAgICAgICAgIGFsZXJ0KCdXZWxjb21lICcgKyB1c2VyLm5hbWUgKyAnIScpO1xuICAgICAgICB9KTsgXG4gICAgfTtcblxuICAgICRzY29wZS5sb2dPdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEF1dGhGYWN0b3J5LmxvZ091dCgpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2hvd0xvZ2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbW9kYWwgPSBhbmd1bGFyLmVsZW1lbnQoJyNsb2dpbk1vZGFsJyk7XG4gICAgICAgIG1vZGFsLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICAgIG1vZGFsLmFkZENsYXNzKCdzaG93Jyk7XG4gICAgfTtcblxuICAgICRzY29wZS5zaG93U2lnbnVwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbW9kYWwgPSBhbmd1bGFyLmVsZW1lbnQoJyNzaWdudXBNb2RhbCcpO1xuICAgICAgICBtb2RhbC5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICBtb2RhbC5hZGRDbGFzcygnc2hvdycpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjbG9naW5Nb2RhbCcpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI2xvZ2luTW9kYWwnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNzaWdudXBNb2RhbCcpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI3NpZ251cE1vZGFsJykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICB9O1xufSk7XG4iLCJhcHAuZmFjdG9yeSgnQXV0aEZhY3RvcnknLCBmdW5jdGlvbiAoJGh0dHAsICRzdGF0ZSkge1xuICAgIGZ1bmN0aW9uIHRvRGF0YShyZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbG9naW46IGZ1bmN0aW9uIChjcmVkZW50aWFscykge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvbG9naW4nLCBjcmVkZW50aWFscylcbiAgICAgICAgICAgICAgICAudGhlbih0b0RhdGEpO1xuICAgICAgICB9LFxuICAgICAgICByZWdpc3RlcjogZnVuY3Rpb24gKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL3JlZ2lzdGVyJywgY3JlZGVudGlhbHMpXG4gICAgICAgICAgICAgICAgLnRoZW4odG9EYXRhKTtcbiAgICAgICAgfSxcbiAgICAgICAgbG9nb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL2xvZ291dCcpXG4gICAgICAgICAgICAgICAgLnRoZW4odG9EYXRhKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2lnbkluV2l0aEdvb2dsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL2F1dGgvZ29vZ2xlJylcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufSk7XG4iLCJhcHAuZGlyZWN0aXZlKCdsb2dpbicsIGZ1bmN0aW9uKCl7XG5cdHJldHVybiB7XG5cdFx0cmVzdHJpY3Q6ICdFJyxcblx0XHR0ZW1wbGF0ZVVybDogJy9hcHAvYXV0aC9hdXRoLmh0bWwnLFxuXHRcdGNvbnRyb2xsZXI6ICdBdXRoQ29udHJvbGxlcidcblx0fTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdNYXBDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgTWFwRmFjdG9yeSwgc3RhdGlvbnMsIHVwZGF0ZXMpIHtcbiAgICB2YXIgbWFwO1xuICAgICRzY29wZS5pbml0TWFwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaG9tZSA9IHtcbiAgICAgICAgICAgIGxhdDogNDAuNzI5NTQ2LFxuICAgICAgICAgICAgbG5nOiAtNzMuOTg1NjlcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoYW5ndWxhci5lbGVtZW50KCcjbWFwLWNhbnZhcycpWzBdLCB7XG4gICAgICAgICAgICBjZW50ZXI6IGhvbWUsXG4gICAgICAgICAgICB6b29tOiAxM1xuICAgICAgICB9KTtcbiAgICAgICAgTWFwRmFjdG9yeS5tYXAgPSBtYXA7XG5cbiAgICAgICAgdmFyIGJpa2VMYXllciA9IG5ldyBnb29nbGUubWFwcy5CaWN5Y2xpbmdMYXllcigpO1xuICAgICAgICBiaWtlTGF5ZXIuc2V0TWFwKG1hcCk7XG5cbiAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICAgICAgXG4gICAgICAgIHZhciBpbmZvd2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coKTtcbiAgICAgICAgbWFwLmFkZExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGluZm93aW5kb3cuY2xvc2UoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBzdGF0aW9ucy5kYXRhLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICB2YXIgbWFya2VyID0gJHNjb3BlLmRyYXdMb2NhdGlvbihbZWwubGF0aXR1ZGUsIGVsLmxvbmdpdHVkZV0sIHt9KTtcbiAgICAgICAgICAgIE1hcEZhY3RvcnkubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gICAgICAgICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGluZm93aW5kb3cuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudFN0cmluZztcbiAgICAgICAgICAgICAgICBjb250ZW50U3RyaW5nID0gXCI8cD5TdGF0aW9uOiBcIiArIGVsLmxhYmVsICsgXCI8L3A+XCIgK1xuICAgICAgICAgICAgICAgICAgICBcIjxwPkJpa2VzOiBcIiArIHVwZGF0ZXMuZGF0YVtlbC5zdGF0aW9uSWRdWzBdICsgJzwvcD4nICtcbiAgICAgICAgICAgICAgICAgICAgXCI8cD5Eb2NrczogXCIgKyB1cGRhdGVzLmRhdGFbZWwuc3RhdGlvbklkXVsxXSArICc8L3A+JyArXG4gICAgICAgICAgICAgICAgICAgIFwiPHA+QWN0aXZlOiBcIiArIGVsLnN0YXR1cyArICc8L3A+JyArXG4gICAgICAgICAgICAgICAgICAgIFwiPHA+TGFzdCBVcGRhdGU6IFwiICsgJHNjb3BlLnNldERhdGUodXBkYXRlcy5kYXRhW2VsLnN0YXRpb25JZF1bMl0pICsgJzwvcD4nO1xuICAgICAgICAgICAgICAgIGluZm93aW5kb3cuc2V0Q29udGVudChjb250ZW50U3RyaW5nKTtcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93Lm9wZW4obWFwLCBtYXJrZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUudXBkYXRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTWFwRmFjdG9yeS5nZXRVcGRhdGVzKClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZXMgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdE1hcCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5yZW1vdmVNYXJrZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBNYXBGYWN0b3J5Lm1hcmtlcnMuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIGVsLnNldE1hcChudWxsKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zaG93TWFya2VycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTWFwRmFjdG9yeS5tYXJrZXJzLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICBlbC5zZXRNYXAoTWFwRmFjdG9yeS5tYXApO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNldERhdGUgPSBmdW5jdGlvbiAodW5peCkge1xuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHVuaXggKiAxMDAwKTtcbiAgICAgICAgdmFyIGhvdXJzID0gZGF0ZS5nZXRIb3VycygpO1xuICAgICAgICB2YXIgYW1wbSA9IChkYXRlLmdldEhvdXJzKCkgPiAxMikgPyAnUE0nIDogJ0FNJztcbiAgICAgICAgaG91cnMgPSBob3VycyAlIDEyO1xuICAgICAgICBob3VycyA9IChob3VycykgPyBob3VycyA6IDEyO1xuICAgICAgICB2YXIgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpO1xuICAgICAgICBtaW51dGVzID0gKG1pbnV0ZXMgPCAxMCkgPyAnMCcgKyBtaW51dGVzIDogbWludXRlcztcbiAgICAgICAgcmV0dXJuICdUb2RheSBAICcgKyBob3VycyArICc6JyArIG1pbnV0ZXMgKyAnICcgKyBhbXBtO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZHJhd0xvY2F0aW9uID0gZnVuY3Rpb24gKGxvY2F0aW9uLCBvcHRzKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0cyAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIG9wdHMgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBvcHRzLmljb24gPSAnL2ltYWdlcy9iaWtlLnBuZyc7XG4gICAgICAgIG9wdHMucG9zaXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxvY2F0aW9uWzBdLCBsb2NhdGlvblsxXSk7XG4gICAgICAgIG9wdHMubWFwID0gbWFwO1xuICAgICAgICByZXR1cm4gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcihvcHRzKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNldE1hcENlbnRlciA9IGZ1bmN0aW9uIChsb2NhdGlvbk9iaikge1xuICAgICAgICB2YXIgY2VudGVyID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsb2NhdGlvbk9ialswXS5sYXQsIGxvY2F0aW9uT2JqWzFdLmxuZyk7XG4gICAgICAgIE1hcEZhY3RvcnkubWFwLnNldENlbnRlcihjZW50ZXIpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuaW5pdE1hcCgpO1xufSk7XG4iLCJhcHAuZmFjdG9yeSgnTWFwRmFjdG9yeScsIGZ1bmN0aW9uKCRodHRwKXtcblx0cmV0dXJuIHtcblx0XHRzdGF0aW9uczogW10sXG5cdFx0dXBkYXRlczoge30sXG5cdFx0b3JpZ2luOiBudWxsLFxuXHRcdGRlc3RpbmF0aW9uOiBudWxsLFxuXHRcdG1hcDogbnVsbCxcblx0XHR1c2VySG9tZTogbnVsbCxcblx0XHRtYXJrZXJzOiBbXSxcblx0XHRnZXRTdGF0aW9uczogZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvc3RhdGlvbnMnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2U7XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdGdldFVwZGF0ZXM6IGZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VwZGF0ZScpXG5cdFx0XHQudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHRcdHJldHVybiByZXNwb25zZTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0c2V0Q2VudGVyOiBmdW5jdGlvbiAobG9jYXRpb25PYmopIHtcblx0XHQgICAgdmFyIGNlbnRlciA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobG9jYXRpb25PYmpbMF0ubGF0LCBsb2NhdGlvbk9ialsxXS5sbmcpO1xuXHRcdCAgICB0aGlzLm1hcC5zZXRDZW50ZXIoY2VudGVyKTtcblx0XHR9XG5cdH07XG59KTsiLCJhcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgLnN0YXRlKCdtYXAnLCB7XG4gICAgICAgICAgICB1cmw6ICcnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiL2FwcC9tYXAvbWFwLmh0bWxcIixcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNYXBDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICBzdGF0aW9uczogZnVuY3Rpb24gKE1hcEZhY3RvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hcEZhY3RvcnkuZ2V0U3RhdGlvbnMoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVwZGF0ZXM6IGZ1bmN0aW9uIChNYXBGYWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXBGYWN0b3J5LmdldFVwZGF0ZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgIC5zdGF0ZSgnbWFwLnBhbmVsJywge1xuICAgICAgICAgICAgdXJsOiAnL3BhbmVsJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wYW5lbC9wYW5lbC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQYW5lbENvbnRyb2xsZXInXG4gICAgICAgIH0pO1xuICAgICR1cmxSb3V0ZXJQcm92aWRlci53aGVuKCcvYXBpL2F1dGgvZ29vZ2xlJywgJy8nKTtcbn0pO1xuIiwiYXBwLmRpcmVjdGl2ZSgnZm9vdGVyJywgZnVuY3Rpb24oKXtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogXCJFXCIsXG5cdFx0dGVtcGxhdGVVcmw6IFwiL2Zvb3Rlci5odG1sXCJcblx0fTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdQYW5lbENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBNYXBGYWN0b3J5KSB7XG4gICAgdmFyIG9yaWdpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWMtaW5wdXQtb3JpZ2luJyk7XG4gICAgdmFyIG9yaWdpbkJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuQXV0b2NvbXBsZXRlKG9yaWdpbik7XG4gICAgdmFyIGRlc3RpbmF0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhYy1pbnB1dC1kZXN0aW5hdGlvbicpO1xuICAgIHZhciBkZXN0aW5hdGlvbkJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuQXV0b2NvbXBsZXRlKGRlc3RpbmF0aW9uKTtcblxuICAgIG9yaWdpbkJveC5hZGRMaXN0ZW5lcigncGxhY2VfY2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgTWFwRmFjdG9yeS5vcmlnaW4gPSBvcmlnaW5Cb3guZ2V0UGxhY2UoKTtcbiAgICB9KTtcblxuICAgIGRlc3RpbmF0aW9uQm94LmFkZExpc3RlbmVyKCdwbGFjZV9jaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBNYXBGYWN0b3J5LmRlc3RpbmF0aW9uID0gZGVzdGluYXRpb25Cb3guZ2V0UGxhY2UoKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIG5ld0xhdExuZ09iaihsb2NhdGlvbk9iaikge1xuICAgICAgICB2YXIgbmV3TG9jID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhcbiAgICAgICAgICAgIGxvY2F0aW9uT2JqLmdlb21ldHJ5LmxvY2F0aW9uLmxhdCgpLFxuICAgICAgICAgICAgbG9jYXRpb25PYmouZ2VvbWV0cnkubG9jYXRpb24ubG5nKClcbiAgICAgICAgICAgICk7XG4gICAgICAgIHJldHVybiBuZXdMb2M7XG4gICAgfVxuXG4gICAgJHNjb3BlLnNldEJvdW5kcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcbiAgICAgICAgb3JpZ2luID0gbmV3TGF0TG5nT2JqKE1hcEZhY3Rvcnkub3JpZ2luKTtcbiAgICAgICAgZGVzdGluYXRpb24gPSBuZXdMYXRMbmdPYmooTWFwRmFjdG9yeS5kZXN0aW5hdGlvbik7XG4gICAgICAgIGJvdW5kcy5leHRlbmQob3JpZ2luKTtcbiAgICAgICAgYm91bmRzLmV4dGVuZChkZXN0aW5hdGlvbik7XG4gICAgICAgIE1hcEZhY3RvcnkubWFwLmZpdEJvdW5kcyhib3VuZHMpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZ2V0VHJhdmVsVGltZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlzdGFuY2VNYXRyaXhTZXJ2aWNlO1xuICAgICAgICB2YXIgaW5mb3dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KCk7XG4gICAgICAgIHNlcnZpY2UuZ2V0RGlzdGFuY2VNYXRyaXgoe1xuICAgICAgICAgICAgb3JpZ2luczogW25ld0xhdExuZ09iaihNYXBGYWN0b3J5Lm9yaWdpbildLFxuICAgICAgICAgICAgZGVzdGluYXRpb25zOiBbbmV3TGF0TG5nT2JqKE1hcEZhY3RvcnkuZGVzdGluYXRpb24pXSxcbiAgICAgICAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLlRyYXZlbE1vZGUuQklDWUNMSU5HLFxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMuRGlzdGFuY2VNYXRyaXhTdGF0dXMuT0spIHtcbiAgICAgICAgICAgICAgICBpbmZvd2luZG93LnNldENvbnRlbnQocmVzcG9uc2Uucm93c1swXS5lbGVtZW50c1swXS5kdXJhdGlvbi50ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jYWxjQW5kRGlzcGxheVJvdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGlyZWN0aW9uc1NlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1NlcnZpY2U7XG4gICAgICAgICRzY29wZS5nZXRUcmF2ZWxUaW1lKCk7XG4gICAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKHtcbiAgICAgICAgICAgIG9yaWdpbjogbmV3TGF0TG5nT2JqKE1hcEZhY3Rvcnkub3JpZ2luKSxcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBuZXdMYXRMbmdPYmooTWFwRmFjdG9yeS5kZXN0aW5hdGlvbiksXG4gICAgICAgICAgICB0cmF2ZWxNb2RlOiBnb29nbGUubWFwcy5UcmF2ZWxNb2RlLkJJQ1lDTElORyxcbiAgICAgICAgICAgIHByb3ZpZGVSb3V0ZUFsdGVybmF0aXZlczogdHJ1ZVxuICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1N0YXR1cy5PSykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2Uucm91dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IChpID09PSAwKSA/ICdEb2RnZXJCbHVlJyA6ICdEYXJrR3JheSc7XG4gICAgICAgICAgICAgICAgICAgIHZhciB6SW5kZXggPSAoaSA9PT0gMCkgPyAxMDAwIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnMgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogTWFwRmFjdG9yeS5tYXAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zOiByZXNwb25zZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSW5kZXg6IGksXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2x5bGluZU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VDb2xvcjogY29sb3IsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogekluZGV4LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSBkaXJlY3Rpb25zLnNldFBhbmVsKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJlY3Rpb25zUGFuZWwnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuYWxlcnQoJ0RpcmVjdGlvbnMgcmVxdWVzdCBmYWlsZWQgZHVlIHRvOiAnLCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmYWlsZWQnLCByZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufSk7XG4iLCJhcHAuZGlyZWN0aXZlKCdtb2RhbCcsIGZ1bmN0aW9uKCl7XG5cdHJldHVybiB7XG5cdFx0cmVzdHJpY3Q6ICdFJyxcblx0XHR0ZW1wbGF0ZVVybDogJy9tb2RhbC5odG1sJ1xuXHR9O1xufSk7IiwiYXBwLmNvbnRyb2xsZXIoJ05hdmJhckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBBdXRoRmFjdG9yeSl7XG5cdCRzY29wZS5zaG93TG9naW4gPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgbW9kYWwgPSBhbmd1bGFyLmVsZW1lbnQoJyNsb2dpbk1vZGFsJyk7XG5cdFx0aWYgKG1vZGFsLmhhc0NsYXNzKCdzaG93JykpIHtcblx0XHRcdG1vZGFsLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG5cdFx0XHRtb2RhbC5hZGRDbGFzcygnaGlkZScpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtb2RhbC5yZW1vdmVDbGFzcygnaGlkZScpO1xuXHRcdFx0bW9kYWwuYWRkQ2xhc3MoJ3Nob3cnKTtcblx0XHR9XG5cdH07XG5cblx0JHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcblx0XHRBdXRoRmFjdG9yeS5sb2dvdXQoKTtcblx0fTtcblxuXHQkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCl7XG5cdFx0YW5ndWxhci5lbGVtZW50KCcjbG9naW5Nb2RhbCcpLmFkZENsYXNzKCdoaWRlJyk7XG5cdFx0YW5ndWxhci5lbGVtZW50KCcjbG9naW5Nb2RhbCcpLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG5cdH07XG59KTsiLCJhcHAuZGlyZWN0aXZlKCduYXZiYXInLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6IFwiL25hdmJhci5odG1sXCIsXG5cdFx0Y29udHJvbGxlcjogJ05hdmJhckNvbnRyb2xsZXInXG5cdH07XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
